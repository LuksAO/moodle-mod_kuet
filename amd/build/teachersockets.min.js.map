{"version":3,"file":"teachersockets.min.js","sources":["../src/teachersockets.js"],"sourcesContent":["\"use strict\";\n\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\n\nlet REGION = {\n    MESSAGEBOX: '#message-box',\n    USERLIST: '[data-region=\"active-users\"]',\n    COUNTUSERS: '#countusers'\n};\n\nlet ACTION = {\n    BACKSESSION: '[data-action=\"back-session\"]',\n    INITSESSION: '[data-action=\"init-session\"]',\n};\n\nlet SERVICES = {\n    ACTIVESESSION: 'mod_jqshow_activesession'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PARTICIPANT: 'mod_jqshow/session/manual/waitingroom/participant'\n};\n\nlet portUrl = '8080'; // It is rewritten in the constructor.\n\n/**\n * @constructor\n * @param {String} region\n * @param {String} port\n */\nfunction Sockets(region, port) {\n    this.root = jQuery(region);\n    portUrl = port;\n    this.measuringSpeed();\n    this.disableDevTools(); // TODO extend to the whole mod.\n    this.initSockets();\n    this.cleanMessages();\n}\n\nSockets.prototype.cleanMessages = function() {\n    setInterval(function() {\n        messageBox.find(':first-child').remove();\n    }, 10000);\n};\n\nSockets.prototype.disableDevTools = function(){\n    document.addEventListener('contextmenu', (e) => e.preventDefault());\n    document.onkeydown = (e) => {\n        return !(event.keyCode === 123 ||\n            this.ctrlShiftKey(e, 'I') ||\n            this.ctrlShiftKey(e, 'J') ||\n            this.ctrlShiftKey(e, 'C') ||\n            (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0)));\n    };\n};\n\nSockets.prototype.ctrlShiftKey = function(e, keyCode) {\n    return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);\n};\n\nSockets.prototype.measuringSpeed = function() {\n    let connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n    if (connection) {\n        let typeConnection = connection.effectiveType;\n        let speedMbps = connection.downlink;\n        // eslint-disable-next-line no-console\n        console.log(\"Type of Connection: \" + typeConnection, \"Estimated speed: \" + speedMbps + \" Mbps\");\n        if (speedMbps < 1) {\n            let reason = {\n                effectiveType: connection.effectiveType,\n                downlink: connection.downlink\n            };\n            getString('lowspeed', 'mod_jqshow', reason).done((s) => {\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n                );\n            });\n        }\n    } else {\n        // eslint-disable-next-line no-console\n        console.log(\"Connection speed detection is not supported in this browser.\");\n    }\n};\n\n/* ****************** */\n\n/** @type {jQuery} The jQuery node for the page region. */\nSockets.prototype.root = null;\n\nlet userid = null;\nlet usersocketid = null;\nlet username = null;\nlet messageBox = null;\nlet countusers = null;\nlet cmid = null;\nlet sid = null;\nconst password = 'elktkktagqes';\nconst abc = 'abcdefghijklmnopqrstuvwxyz0123456789=ABCDEFGHIJKLMNOPQRSTUVWXYZ/+-*';\n\nSockets.prototype.initSockets = function() {\n    userid = this.root[0].dataset.userid;\n    username = this.root[0].dataset.username;\n    cmid = this.root[0].dataset.cmid;\n    sid = this.root[0].dataset.sid;\n    messageBox = this.root.find(REGION.MESSAGEBOX);\n    countusers = this.root.find(REGION.COUNTUSERS);\n\n    this.root.find(ACTION.BACKSESSION).on('click', this.backSession);\n\n    Sockets.prototype.webSocket = new WebSocket(\n        'wss://' + M.cfg.wwwroot.replace(/^https?:\\/\\//, '') + ':' + portUrl + '/jqshow'\n    );\n\n    Sockets.prototype.webSocket.onopen = function() {\n        /* TODO call service to get all the quiz questions,\n            and generate an iterator to call .next() each time the socket/professor says so. */\n    };\n\n    Sockets.prototype.webSocket.onmessage = function(ev) {\n        let msgDecrypt = Sockets.prototype.decrypt(password, ev.data);\n        let response = JSON.parse(msgDecrypt); // PHP sends Json data.\n        let resAction = response.action; // Message type.\n        switch (resAction) {\n            case 'connect':\n                // The server has returned the connected status, it is time to identify yourself.\n                if (response.usersocketid !== undefined) {\n                    usersocketid = response.usersocketid;\n                    let msg = {\n                        'userid': userid,\n                        'name': username,\n                        'isteacher': true,\n                        'cmid': cmid,\n                        'sid': sid,\n                        'usersocketid': usersocketid,\n                        'action': 'newuser'\n                    };\n                    Sockets.prototype.sendMessageSocket(JSON.stringify(msg));\n                }\n                break;\n            case 'newuser': {\n                let identifier = jQuery(REGION.USERLIST);\n                let data = response.students;\n                identifier.html('');\n                jQuery.each(data, function(i, student) {\n                    let templateContext = {\n                        'usersocketid': student.usersocketid,\n                        'userimage': student.picture,\n                        'userfullname': student.name,\n                    };\n                    Templates.render(TEMPLATES.PARTICIPANT, templateContext).then(function(html) {\n                        identifier.append(html);\n                    }).fail(Notification.exception);\n                });\n                countusers.html(response.count);\n                break;\n            }\n            case 'countusers':\n                countusers.html(response.count);\n                break;\n            case 'userdisconnected':\n                jQuery('[data-userid=\"' + response.usersocketid + '\"]').remove();\n                countusers.html(response.count);\n                messageBox.append('<div>' + response.message + '</div>');\n                break;\n            case 'alreadyteacher':\n                messageBox.append(\n                    '<div class=\"alert alert-danger\" role=\"alert\">' + response.message + '</div>'\n                );\n                break;\n            default:\n                break;\n        }\n        messageBox[0].scrollTop = messageBox[0].scrollHeight;\n    };\n\n    Sockets.prototype.webSocket.onerror = function() {\n        getString('system_error', 'mod_jqshow').done((s) => {\n            messageBox.append(\n                '<div class=\"alert alert-danger\" role=\"alert\">' + s + '</div>'\n            );\n        });\n    };\n\n    Sockets.prototype.webSocket.onclose = function(ev) {\n        let reason = {\n            reason: ev.reason,\n            code: ev.code\n        };\n        getString('connection_closed', 'mod_jqshow', reason).done((s) => {\n            messageBox.append(\n                '<div class=\"alert alert-warning\" role=\"alert\">' + s + '</div>'\n            );\n            setTimeout(() => {\n                // ... window.location.replace(M.cfg.wwwroot + '/mod/jqshow/view.php?id=' + cmid);\n            }, 5000);\n        });\n    };\n};\n\nSockets.prototype.backSession = function() {\n    const stringkeys = [\n        {key: 'backtopanelfromsession', component: 'mod_jqshow'},\n        {key: 'backtopanelfromsession_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.ACTIVESESSION,\n                    args: {\n                        cmid: cmid,\n                        sessionid: sid\n                    }\n                };\n                Ajax.call([request])[0].done(function() {\n                    window.location.replace(M.cfg.wwwroot + '/mod/jqshow/view.php?id=' + cmid);\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSockets.prototype.sendMessageSocket = function(msg) {\n    this.webSocket.send(msg);\n};\n\nSockets.prototype.decrypt = function(password, text) {\n    const arr = text.split('');\n    const arrPass = password.split('');\n    let lastPassLetter = 0;\n    let decrypted = '';\n    for (let i = 0; i < arr.length; i++) {\n        const letter = arr[i];\n        const passwordLetter = arrPass[lastPassLetter];\n        const temp = this.getInvertedLetterFromAlphabetForLetter(passwordLetter, letter);\n        if (temp) {\n            decrypted += temp;\n        } else {\n            return null;\n        }\n        if (lastPassLetter === (arrPass.length - 1)) {\n            lastPassLetter = 0;\n        } else {\n            lastPassLetter++;\n        }\n    }\n    return atob(decrypted);\n};\n\nSockets.prototype.getInvertedLetterFromAlphabetForLetter = function(letter, letterToChange) {\n    const posLetter = abc.indexOf(letter);\n    if (posLetter == -1) {\n        // eslint-disable-next-line no-console\n        console.log('Password letter ' + letter + ' not allowed.');\n        return null;\n    }\n\n    const part1 = abc.substring(posLetter, abc.length);\n    const part2 = abc.substring(0, posLetter);\n    const newABC = '' + part1 + '' + part2;\n    const posLetterToChange = newABC.indexOf( letterToChange );\n\n    if (posLetterToChange == -1) {\n        // eslint-disable-next-line no-console\n        console.log('Password letter ' + letter + ' not allowed.');\n        return null;\n    }\n\n    return abc.split('')[posLetterToChange];\n};\n\nSockets.prototype.encrypt = function(password, text) {\n    const base64 = btoa(text);\n    const arr = base64.split('');\n    const arrPass = password.split('');\n    let lastPassLetter = 0;\n    let encrypted = '';\n    for (let i = 0; i < arr.length; i++) {\n        const letter = arr[i];\n        const passwordLetter = arrPass[lastPassLetter];\n        const temp = this.getLetterFromAlphabetForLetter( passwordLetter, letter );\n        if (temp) {\n            encrypted += temp;\n        } else {\n            return null;\n        }\n        if (lastPassLetter === (arrPass.length - 1)) {\n            lastPassLetter = 0;\n        } else {\n            lastPassLetter++;\n        }\n    }\n    return encrypted;\n};\n\nSockets.prototype.getLetterFromAlphabetForLetter = function(letter, letterToChange) {\n    const posLetter = abc.indexOf(letter);\n    if (posLetter == -1) {\n        // eslint-disable-next-line no-console\n        console.log('Password letter ' + letter + ' not allowed.');\n        return null;\n    }\n    const posLetterToChange = abc.indexOf(letterToChange);\n    if (posLetterToChange == -1) {\n        // eslint-disable-next-line no-console\n        console.log('Password letter ' + letter + ' not allowed.');\n        return null;\n    }\n    const part1 = abc.substring(posLetter, abc.length);\n    const part2 = abc.substring(0, posLetter);\n    const newABC = '' + part1 + '' + part2;\n    return newABC.split('')[posLetterToChange];\n};\n\nexport const teacherInitSockets = (region, port) => {\n    return new Sockets(region, port);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","teacherInitSockets","_jquery","_templates","_notification","_modal_factory","_modal_events","_ajax","REGION","ACTION","SERVICES","TEMPLATES","portUrl","Sockets","region","port","this","root","jQuery","measuringSpeed","disableDevTools","initSockets","cleanMessages","prototype","setInterval","messageBox","find","remove","_this","document","addEventListener","e","preventDefault","onkeydown","event","keyCode","ctrlShiftKey","ctrlKey","charCodeAt","shiftKey","connection","navigator","mozConnection","webkitConnection","typeConnection","effectiveType","speedMbps","downlink","console","log","reason","getString","get_string","done","s","append","userid","usersocketid","username","countusers","cmid","sid","abc","dataset","on","backSession","webSocket","WebSocket","M","cfg","wwwroot","replace","onopen","onmessage","ev","msgDecrypt","decrypt","data","response","JSON","parse","action","undefined","msg","name","isteacher","sendMessageSocket","stringify","identifier","students","html","each","i","student","templateContext","userimage","picture","userfullname","Templates","render","then","fail","Notification","exception","count","message","scrollTop","scrollHeight","onerror","onclose","code","setTimeout","getStrings","key","component","langStrings","ModalFactory","create","title","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","request","methodname","args","sessionid","Ajax","call","window","location","hidden","destroy","show","send","password","text","arr","split","arrPass","lastPassLetter","decrypted","length","letter","passwordLetter","temp","getInvertedLetterFromAlphabetForLetter","atob","letterToChange","posLetter","indexOf","posLetterToChange","substring","encrypt","btoa","encrypted","getLetterFromAlphabetForLetter"],"mappings":"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"}