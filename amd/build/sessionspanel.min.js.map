{"version":3,"file":"sessionspanel.min.js","sources":["../src/sessionspanel.js"],"sourcesContent":["\"use strict\";\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\nlet ACTION = {\n    COPYSESSION: '[data-action=\"copy_session\"]',\n    DELETESESSION: '[data-action=\"delete_session\"]',\n    INITSESSION: '[data-action=\"init_session\"]'\n};\n\nlet SERVICES = {\n    SESSIONSPANEL: 'mod_jqshow_sessionspanel',\n    COPYSESSION: 'mod_jqshow_copysession',\n    DELETESESSION: 'mod_jqshow_deletesession',\n    STARTSESSION: 'mod_jqshow_startsession'\n};\n\nlet REGION = {\n    SESSIONSPANEL: '[data-region=\"sessions-panel-reload\"]',\n    PANEL: '[data-region=\"sessions-panel\"]'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    SUCCESS: 'core/notification_success',\n    ERROR: 'core/notification_error',\n    PANEL: 'mod_jqshow/sessions_panel'\n};\n\nlet cmId;\nlet courseId;\n\n/**\n * @constructor\n * @param {String} selector The selector for the page region containing the page.\n */\nfunction SessionsPanel(selector) {\n    this.node = jQuery(selector);\n    courseId = this.node.attr('data-courseid');\n    cmId = this.node.attr('data-cmid');\n    this.initPanel();\n}\n\n/** @type {jQuery} The jQuery node for the page region. */\nSessionsPanel.prototype.node = null;\n\nSessionsPanel.prototype.initPanel = function() {\n    this.node.find(ACTION.COPYSESSION).on('click', this.copySession);\n    this.node.find(ACTION.DELETESESSION).on('click', this.deleteSession);\n    this.node.find(ACTION.INITSESSION).on('click', this.initSession);\n};\n\nSessionsPanel.prototype.copySession = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    const stringkeys = [\n        {key: 'copysession', component: 'mod_jqshow'},\n        {key: 'copysession_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'},\n        {key: 'copysessionerror', component: 'mod_jqshow'},\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        const title = langStrings[0];\n        const confirmMessage = langStrings[1];\n        const buttonText = langStrings[2];\n        const copysessionerror = langStrings[3];\n        return ModalFactory.create({\n            title: title,\n            body: confirmMessage,\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(buttonText);\n            modal.getRoot().on(ModalEvents.save, () => {\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.PANEL);\n                    identifier.append(html);\n                    let request = {\n                        methodname: SERVICES.COPYSESSION,\n                        args: {\n                            courseid: courseId,\n                            sessionid: sessionId\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(copied) {\n                        if (copied) {\n                            let requestPanel = {\n                                methodname: SERVICES.SESSIONSPANEL,\n                                args: {\n                                    cmid: cmId\n                                }\n                            };\n                            // eslint-disable-next-line max-nested-callbacks\n                            Ajax.call([requestPanel])[0].done(function(response) {\n                                // eslint-disable-next-line max-nested-callbacks,promise/always-return\n                                Templates.render(TEMPLATES.PANEL, response).then((html, js) => {\n                                    identifier.html(html);\n                                    Templates.runTemplateJS(js);\n                                }).fail(Notification.exception);\n                            }).fail(Notification.exception);\n                        } else {\n                            Notification.exception({message: copysessionerror});\n                        }\n                    });\n                });\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nSessionsPanel.prototype.deleteSession = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    const stringkeys = [\n        {key: 'deletesession', component: 'mod_jqshow'},\n        {key: 'deletesession_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'},\n        {key: 'deletesessionrror', component: 'mod_jqshow'},\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        const title = langStrings[0];\n        const confirmMessage = langStrings[1];\n        const buttonText = langStrings[2];\n        const copysessionerror = langStrings[3];\n        return ModalFactory.create({\n            title: title,\n            body: confirmMessage,\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(buttonText);\n            modal.getRoot().on(ModalEvents.save, () => {\n                Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n                    let identifier = jQuery(REGION.PANEL);\n                    identifier.append(html);\n                    let request = {\n                        methodname: SERVICES.DELETESESSION,\n                        args: {\n                            courseid: courseId,\n                            sessionid: sessionId\n                        }\n                    };\n                    Ajax.call([request])[0].done(function(deleted) {\n                        if (deleted) {\n                            let requestPanel = {\n                                methodname: SERVICES.SESSIONSPANEL,\n                                args: {\n                                    cmid: cmId\n                                }\n                            };\n                            // eslint-disable-next-line max-nested-callbacks\n                            Ajax.call([requestPanel])[0].done(function(response) {\n                                let templatePanel = TEMPLATES.PANEL;\n                                // eslint-disable-next-line max-nested-callbacks\n                                Templates.render(templatePanel, response).done(function(html, js) {\n                                    identifier.html(html);\n                                    Templates.runTemplateJS(js);\n                                });\n                            }).fail(Notification.exception);\n                        } else {\n                            Notification.exception({message: copysessionerror});\n                        }\n                    });\n                });\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n\n};\n\nSessionsPanel.prototype.initSession = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    const stringkeys = [\n        {key: 'init_session', component: 'mod_jqshow'},\n        {key: 'init_session_desc', component: 'mod_jqshow'},\n        {key: 'confirm', component: 'mod_jqshow'}\n    ];\n    getStrings(stringkeys).then((langStrings) => {\n        return ModalFactory.create({\n            title: langStrings[0],\n            body: langStrings[1],\n            type: ModalFactory.types.SAVE_CANCEL\n        }).then(modal => {\n            modal.setSaveButtonText(langStrings[2]);\n            modal.getRoot().on(ModalEvents.save, () => {\n                let request = {\n                    methodname: SERVICES.STARTSESSION,\n                    args: {\n                        cmid: cmId,\n                        sessionid: sessionId\n                    }\n                };\n                Ajax.call([request])[0].done(function(response) {\n                    if (response.started === true) {\n                        window.location.replace(M.cfg.wwwroot + '/mod/jqshow/session.php?cmid=' + cmId + '&sid=' + sessionId);\n                    } else {\n                        const stringkeyserror = [\n                            {key: 'error_initsession', component: 'mod_jqshow'},\n                            {key: 'error_initsession_desc', component: 'mod_jqshow'},\n                            {key: 'confirm', component: 'mod_jqshow'}\n                        ];\n                        getStrings(stringkeyserror).then((langStringsError) => {\n                            return ModalFactory.create({\n                                title: langStringsError[0],\n                                body: langStringsError[1],\n                                type: ModalFactory.types.ALERT,\n                                buttons: {\n                                    cancel: langStringsError[2],\n                                },\n                                removeOnClose: true,\n                                // eslint-disable-next-line max-nested-callbacks\n                            }).then(modalError => {\n                                modalError.getRoot().on(ModalEvents.save, () => {\n                                    location.reload();\n                                });\n                                modalError.getRoot().on(ModalEvents.hidden, () => {\n                                    modalError.destroy();\n                                    location.reload();\n                                });\n                                return modalError;\n                            });\n                        }).done(function(modalError) {\n                            modalError.show();\n                            // eslint-disable-next-line no-restricted-globals\n                        }).fail(Notification.exception);\n                    }\n                }).fail(Notification.exception);\n            });\n            modal.getRoot().on(ModalEvents.hidden, () => {\n                modal.destroy();\n            });\n            return modal;\n        });\n    }).done(function(modal) {\n        modal.show();\n        // eslint-disable-next-line no-restricted-globals\n    }).fail(Notification.exception);\n};\n\nexport const initSessionsPanel = (selector) => {\n    return new SessionsPanel(selector);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","initSessionsPanel","_jquery","_ajax","_modal_factory","_modal_events","_templates","_notification","cmId","courseId","ACTION","SERVICES","REGION","TEMPLATES","SessionsPanel","selector","this","node","jQuery","attr","initPanel","prototype","find","on","copySession","deleteSession","initSession","e","preventDefault","stopPropagation","sessionId","currentTarget","getStrings","key","component","then","langStrings","title","confirmMessage","buttonText","copysessionerror","ModalFactory","create","body","type","types","SAVE_CANCEL","modal","setSaveButtonText","getRoot","ModalEvents","save","Templates","render","visible","done","html","identifier","append","request","methodname","args","courseid","sessionid","Ajax","call","copied","requestPanel","cmid","response","js","runTemplateJS","fail","Notification","exception","message","hidden","destroy","show","deleted","templatePanel","started","window","location","replace","M","cfg","wwwroot","langStringsError","ALERT","buttons","cancel","removeOnClose","modalError","reload"],"mappings":"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"}