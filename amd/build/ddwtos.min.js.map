{"version":3,"file":"ddwtos.min.js","sources":["../src/ddwtos.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos\n\n/**\n *\n * @module    mod_kuet/ddwtos\n * @copyright  2023 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport jQuery from 'jquery';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport mEvent from 'core/event';\n/*import DragDrop from 'core/local/reactive/dragdrop';*/\nimport dragDrop from 'core/dragdrop';\n\nlet ACTION = {\n    SEND_RESPONSE: '[data-action=\"send-response\"]',\n};\n\nlet REGION = {\n    ROOT: '[data-region=\"question-content\"]',\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n    NEXT: '[data-action=\"next-question\"]',\n    TIMER: '[data-region=\"question-timer\"]',\n    SECONDS: '[data-region=\"seconds\"]',\n    CONTENTFEEDBACKS: '[data-region=\"containt-feedbacks\"]',\n    FEEDBACK: '[data-region=\"statement-feedback\"]',\n    FEEDBACKANSWER: '[data-region=\"answer-feedback\"]',\n    FEEDBACKBACGROUND: '[data-region=\"feedback-background\"]',\n    AREA: '#drag_and_drop_area',\n    DRAGHOME: '.draghome',\n    DRAGELEMENT: '.draghome.user-select-none',\n    DROPELEMENT: '.drop.active',\n    INPUTPLACE: '.placeinput',\n    STATEMENTTEXT: '[data-region=\"statement-text\"]',\n    STATEMENTTEXT_CONTENT: '[data-region=\"statement-text\"] .statement-text',\n    ICONSANSWERS: '.icon.text-success, .icon.text-danger',\n    ANSWERSCONTENT: '.answercontainer',\n    ANSWERSCONTENTGROUP: '.answercontainer [class*=\"draggrouphomes\"]',\n    MODALBODY: '.modal-body'\n};\n\nlet SERVICES = {\n    REPLY: 'mod_kuet_ddwtos'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading'\n};\n\nlet cmId;\nlet sId;\nlet questionid;\nlet kuetId;\nlet kid;\nlet questionEnd = false;\nlet showQuestionFeedback = false;\nlet manualMode = false;\n\n/** @type {jQuery} The jQuery node for the page region. */\nDdwtos.prototype.node = null;\nDdwtos.prototype.endTimer = new Event('endTimer');\nDdwtos.prototype.studentQuestionEnd = new Event('studentQuestionEnd');\nDdwtos.prototype.questionAnswer = {};\n\n/**\n * @constructor\n * @param {String} selector\n * @param {Boolean} showquestionfeedback\n * @param {Boolean} manualmode\n * @param {String} jsonresponse\n */\nfunction Ddwtos(selector, showquestionfeedback = false, manualmode = false, jsonresponse = '') {\n    this.node = jQuery(selector);\n    sId = this.node.attr('data-sid');\n    cmId = this.node.attr('data-cmid');\n    questionid = this.node.attr('data-questionid');\n    kuetId = this.node.attr('data-kuetid');\n    kid = this.node.attr('data-kid');\n    showQuestionFeedback = showquestionfeedback;\n    manualMode = manualmode;\n    questionEnd = false;\n    if (jsonresponse !== '') {\n        this.answered(jsonresponse, false);\n        if (manualMode === false || jQuery(REGION.MODALBODY).length) {\n            questionEnd = true;\n            if (showQuestionFeedback === true) {\n                this.showFeedback();\n            }\n            this.showAnswers();\n        }\n    }\n    if (jQuery(REGION.MODALBODY).length) {\n        setTimeout(() => {\n            Ddwtos.prototype.initDdwtos();\n        }, 500); // For modal preview, is executed before the DOM is rendered.\n    } else {\n        Ddwtos.prototype.initDdwtos();\n    }\n    questionManager.init('drag_and_drop_area');\n}\n\nDdwtos.prototype.initDdwtos = function() {\n    jQuery(ACTION.SEND_RESPONSE).on('click', Ddwtos.prototype.reply);\n    if (jQuery(REGION.STATEMENTTEXT_CONTENT).hasClass('randomanswers')) {\n        let groups = document.querySelectorAll(REGION.ANSWERSCONTENTGROUP);\n        groups.forEach(function(element){\n            let draghomes = Array.prototype.slice.call(element.getElementsByClassName('draghome'));\n            draghomes.forEach(function(drag){\n                element.removeChild(drag);\n            });\n            Ddwtos.prototype.shuffleArray(draghomes);\n            draghomes.forEach(function(drag){\n                element.appendChild(drag);\n            });\n        });\n    }\n    Ddwtos.prototype.initEvents();\n    Ddwtos.prototype.resizeAllDragsAndDrops();\n    Ddwtos.prototype.cloneDrags();\n    Ddwtos.prototype.positionDrags();\n    if (questionEnd === false) {\n        Ddwtos.prototype.initDragAndDrop();\n    }\n};\n\nDdwtos.prototype.shuffleArray = function(array) {\n    for (let i = array.length - 1; i > 0; i--) {\n        let j = Math.floor(Math.random() * (i + 1));\n        let temp = array[i];\n        array[i] = array[j];\n        array[j] = temp;\n    }\n    return array;\n};\n\nDdwtos.prototype.initEvents = function() {\n    addEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n    if (manualMode !== false) {\n        addEventListener('alreadyAnswered_' + kid, (ev) => {\n            let userid =  jQuery('[data-region=\"student-canvas\"]').data('userid');\n            if (userid != ev.detail.userid) {\n                jQuery('[data-region=\"group-message\"]').css({'z-index': 3, 'padding': '15px'});\n                jQuery('[data-region=\"group-message\"]').show();\n            }\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n        }, {once: true});\n        addEventListener('teacherQuestionEnd_' + kid, (e) => {\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n            e.detail.statistics.forEach((statistic) => {\n                jQuery('#statistics .correct').attr('aria-valuenow', statistic.correct)\n                    .width(statistic.correct + '%').html(statistic.correct + '%');\n                jQuery('#statistics .failure').attr('aria-valuenow', statistic.failure)\n                    .width(statistic.failure + '%').html(statistic.failure + '%');\n                jQuery('#statistics .invalid').attr('aria-valuenow', statistic.invalid)\n                    .width(statistic.invalid + '%').html(statistic.invalid + '%');\n                jQuery('#statistics .noresponse').attr('aria-valuenow', statistic.noresponse)\n                    .width(statistic.noresponse + '%').html(statistic.noresponse + '%');\n                jQuery('#statistics .partially').attr('aria-valuenow', statistic.partially)\n                    .width(statistic.partially + '%').html(statistic.partially + '%');\n            });\n        }, {once: true});\n        addEventListener('pauseQuestion_' + kid, () => {\n            Ddwtos.prototype.pauseQuestion();\n        }, false);\n        addEventListener('playQuestion_' + kid, () => {\n            Ddwtos.prototype.playQuestion();\n        }, false);\n        addEventListener('showAnswers_' + kid, () => {\n            Ddwtos.prototype.showAnswers();\n        }, false);\n        addEventListener('hideAnswers_' + kid, () => {\n            Ddwtos.prototype.hideAnswers();\n        }, false);\n        addEventListener('showStatistics_' + kid, () => {\n            Ddwtos.prototype.showStatistics();\n        }, false);\n        addEventListener('hideStatistics_' + kid, () => {\n            Ddwtos.prototype.hideStatistics();\n        }, false);\n        addEventListener('showFeedback_' + kid, () => {\n            Ddwtos.prototype.showFeedback();\n        }, false);\n        addEventListener('hideFeedback_' + kid, () => {\n            Ddwtos.prototype.hideFeedback();\n        }, false);\n        addEventListener('removeEvents', () => {\n            Ddwtos.prototype.removeEvents();\n        }, {once: true});\n    }\n\n    window.onbeforeunload = function() {\n        if (jQuery(REGION.SECONDS).length > 0 && questionEnd === false) {\n            Ddwtos.prototype.reply();\n            return 'Because the question is overdue and an attempt has been made to reload the page,' +\n                ' the question has remained unanswered.';\n        }\n    };\n};\n\nDdwtos.prototype.showStatistics = function() {\n    if (questionEnd === true) {\n        jQuery('#statistics').css({'display': 'block', 'z-index': 3});\n    }\n};\n\nDdwtos.prototype.hideStatistics = function() {\n    if (questionEnd === true) {\n        jQuery('#statistics').css({'display': 'none', 'z-index': 0});\n    }\n};\n\nDdwtos.prototype.removeEvents = function() {\n    removeEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n    if (manualMode !== false) {\n        removeEventListener('alreadyAnswered_' + kid, (ev) => {\n            let userid =  jQuery('[data-region=\"student-canvas\"]').data('userid');\n            if (userid != ev.detail.userid) {\n                jQuery('[data-region=\"group-message\"]').css({'z-index': 3, 'padding': '15px'});\n                jQuery('[data-region=\"group-message\"]').show();\n            }\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n        }, {once: true});\n        removeEventListener('teacherQuestionEnd_' + kid, (e) => {\n            if (questionEnd !== true) {\n                Ddwtos.prototype.reply();\n            }\n            e.detail.statistics.forEach((statistic) => {\n                jQuery('#statistics .correct').attr('aria-valuenow', statistic.correct)\n                    .width(statistic.correct + '%').html(statistic.correct + '%');\n                jQuery('#statistics .failure').attr('aria-valuenow', statistic.failure)\n                    .width(statistic.failure + '%').html(statistic.failure + '%');\n                jQuery('#statistics .invalid').attr('aria-valuenow', statistic.invalid)\n                    .width(statistic.invalid + '%').html(statistic.invalid + '%');\n                jQuery('#statistics .noresponse').attr('aria-valuenow', statistic.noresponse)\n                    .width(statistic.noresponse + '%').html(statistic.noresponse + '%');\n                jQuery('#statistics .partially').attr('aria-valuenow', statistic.partially)\n                    .width(statistic.partially + '%').html(statistic.partially + '%');\n            });\n        }, {once: true});\n        removeEventListener('pauseQuestion_' + kid, () => {\n            Ddwtos.prototype.pauseQuestion();\n        }, false);\n        removeEventListener('playQuestion_' + kid, () => {\n            Ddwtos.prototype.playQuestion();\n        }, false);\n        removeEventListener('showAnswers_' + kid, () => {\n            Ddwtos.prototype.showAnswers();\n        }, false);\n        removeEventListener('hideAnswers_' + kid, () => {\n            Ddwtos.prototype.hideAnswers();\n        }, false);\n        removeEventListener('showStatistics_' + kid, () => {\n            Ddwtos.prototype.showStatistics();\n        }, false);\n        removeEventListener('hideStatistics_' + kid, () => {\n            Ddwtos.prototype.hideStatistics();\n        }, false);\n        removeEventListener('showFeedback_' + kid, () => {\n            Ddwtos.prototype.showFeedback();\n        }, false);\n        removeEventListener('hideFeedback_' + kid, () => {\n            Ddwtos.prototype.hideFeedback();\n        }, false);\n        removeEventListener('removeEvents', () => {\n            Ddwtos.prototype.removeEvents();\n        }, {once: true});\n    }\n};\n\nDdwtos.prototype.reply = function() {\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        jQuery(REGION.ROOT).append(html);\n        dispatchEvent(Ddwtos.prototype.endTimer);\n        removeEventListener('timeFinish', Ddwtos.prototype.reply, {once: true});\n        Ddwtos.prototype.removeEvents();\n        let inputPlaces = document.querySelectorAll(REGION.INPUTPLACE);\n        let response = {};\n        let i = 1;\n        inputPlaces.forEach(function(input) {\n            response['p' + i] = input.value;\n            i++;\n        });\n        let timeLeft = parseInt(jQuery(REGION.SECONDS).text());\n        let request = {\n            methodname: SERVICES.REPLY,\n            args: {\n                sessionid: sId,\n                kuetid: kuetId,\n                cmid: cmId,\n                questionid: questionid,\n                kid: kid,\n                timeleft: timeLeft || 0,\n                preview: false,\n                response: JSON.stringify(response)\n            }\n        };\n        Ajax.call([request])[0].done(function(response) {\n            if (response.reply_status === true) {\n                questionEnd = true;\n                Ddwtos.prototype.answered(response, true);\n                dispatchEvent(Ddwtos.prototype.studentQuestionEnd);\n                if (jQuery('.modal-body').length) { // Preview.\n                    Ddwtos.prototype.showAnswers();\n                    if (showQuestionFeedback === true) {\n                        Ddwtos.prototype.showFeedback();\n                    }\n                } else {\n                    if (manualMode === false) {\n                        Ddwtos.prototype.showAnswers();\n                        if (showQuestionFeedback === true) {\n                            Ddwtos.prototype.showFeedback();\n                        }\n                    }\n                }\n            } else {\n                alert('error');\n            }\n            jQuery(REGION.LOADING).remove();\n        }).fail(Notification.exception);\n    });\n};\n\n/* DRAG&DROP */\nDdwtos.prototype.initDragAndDrop = function() {\n    let dragItems = document.querySelectorAll(REGION.DRAGELEMENT);\n    dragItems.forEach(function(dragElement) {\n        dragElement.setAttribute('draggable', 'false');\n        jQuery(dragElement).unbind('mousedown touchstart');\n        jQuery(dragElement).on('mousedown touchstart', Ddwtos.prototype.handleDragStart.bind(this));\n    });\n};\n\nDdwtos.prototype.handleDragStart = function(e) {\n    let drag = jQuery(e.target).closest('.draghome');\n    let info = dragDrop.prepare(e);\n    if (!info.start || drag.hasClass('beingdragged')) {\n        return;\n    }\n    drag.addClass('beingdragged');\n    let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n    if (currentPlace !== null) {\n        Ddwtos.prototype.setInputValue(currentPlace, 0);\n        drag.removeClass('inplace' + currentPlace);\n        let hiddenDrop = Ddwtos.prototype.getDrop(drag, currentPlace);\n        if (hiddenDrop.length) {\n            hiddenDrop.addClass('active');\n            drag.offset(hiddenDrop.offset());\n        }\n    } else {\n        let hiddenDrag = Ddwtos.prototype.getDragClone(drag);\n        if (hiddenDrag.length) {\n            if (drag.hasClass('infinite')) {\n                let noOfDrags = Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(drag));\n                let cloneDrags = Ddwtos.prototype.getInfiniteDragClones(drag, false);\n                if (cloneDrags.length < noOfDrags) {\n                    let cloneDrag = drag.clone();\n                    cloneDrag.removeClass('beingdragged');\n                    hiddenDrag.after(cloneDrag);\n                    questionManager.addEventHandlersToDrag(cloneDrag);\n                    drag.offset(cloneDrag.offset());\n                } else {\n                    hiddenDrag.addClass('active');\n                    drag.offset(hiddenDrag.offset());\n                }\n            } else {\n                hiddenDrag.addClass('active');\n                drag.offset(hiddenDrag.offset());\n            }\n        }\n    }\n    dragDrop.start(e, drag, function(x, y, drag) {\n        Ddwtos.prototype.dragMove(x, y, drag);\n    }, function(x, y, drag) {\n        Ddwtos.prototype.dragEnd(x, y, drag);\n    });\n};\n\n\n/* EVENTS */\nDdwtos.prototype.answered = function(response, fromService = false) {\n    questionEnd = true;\n    if (response.hasfeedbacks) {\n        jQuery(REGION.FEEDBACK).html(response.statment_feedback);\n        jQuery(REGION.FEEDBACKANSWER).html(response.answer_feedback);\n    }\n    jQuery(ACTION.SEND_RESPONSE).addClass('d-none');\n    jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\n    jQuery(REGION.STATEMENTTEXT).css({'z-index': 3, 'padding': '15px'});\n    jQuery(REGION.TIMER).css('z-index', 3);\n    if (manualMode === false) {\n        jQuery(REGION.NEXT).removeClass('d-none');\n    }\n    if (fromService === true) {\n        jQuery(REGION.STATEMENTTEXT_CONTENT).html(decodeURIComponent(escape(atob(response.question_text_feedback))));\n        Ddwtos.prototype.resizeAllDragsAndDrops();\n        Ddwtos.prototype.cloneDrags();\n        Ddwtos.prototype.positionDrags();\n    }\n    let dragItems = document.querySelectorAll(REGION.DRAGHOME);\n    dragItems.forEach(function(dragElement) {\n        dragElement.setAttribute('draggable', 'false');\n        jQuery(dragElement).unbind('mousedown touchstart');\n        jQuery(dragElement).off('mousedown touchstart');\n        jQuery(dragElement).css({'pointer-events': 'none'});\n    });\n    let contentFeedbacks = document.querySelector(REGION.CONTENTFEEDBACKS);\n    if (contentFeedbacks !== null) {\n        mEvent.notifyFilterContentUpdated(document.querySelector(REGION.CONTENTFEEDBACKS));\n    }\n};\n\nDdwtos.prototype.pauseQuestion = function() {\n    dispatchEvent(new Event('pauseQuestion'));\n    jQuery(REGION.TIMER).css('z-index', 3);\n    jQuery(REGION.FEEDBACKBACGROUND).css('display', 'block');\n    jQuery(ACTION.REPLY).css('pointer-events', 'none');\n};\n\nDdwtos.prototype.playQuestion = function() {\n    if (questionEnd !== true) {\n        dispatchEvent(new Event('playQuestion'));\n        jQuery(REGION.TIMER).css('z-index', 1);\n        jQuery(REGION.FEEDBACKBACGROUND).css('display', 'none');\n        jQuery(ACTION.REPLY).css('pointer-events', 'auto');\n    }\n};\n\nDdwtos.prototype.showFeedback = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'block', 'z-index': 3});\n    }\n};\n\nDdwtos.prototype.hideFeedback = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.CONTENTFEEDBACKS).css({'display': 'none', 'z-index': 0});\n    }\n};\n\nDdwtos.prototype.showAnswers = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.ICONSANSWERS).css({'display': 'inline-block'});\n    }\n};\n\nDdwtos.prototype.hideAnswers = function() {\n    if (questionEnd === true) {\n        jQuery(REGION.ICONSANSWERS).css({'display': 'none'});\n    }\n};\n\n/* CORE */\nDdwtos.prototype.resizeAllDragsAndDrops = function() {\n    let thisQ = this;\n    jQuery(REGION.AREA).find('.answercontainer > div').each(function(i, node) {\n        thisQ.resizeAllDragsAndDropsInGroup(\n            thisQ.getClassnameNumericSuffix(jQuery(node), 'draggrouphomes'));\n    });\n};\n\nDdwtos.prototype.cloneDrags = function() {\n    jQuery(REGION.AREA).find('span.draghome').each(function(index, draghome) {\n        let drag = jQuery(draghome);\n        let placeHolder = drag.clone();\n        placeHolder.removeClass();\n        placeHolder.addClass('draghome choice' +\n            Ddwtos.prototype.getChoice(drag) + ' group' +\n            Ddwtos.prototype.getGroup(drag) + ' dragplaceholder');\n        drag.before(placeHolder);\n    });\n};\n\nDdwtos.prototype.positionDrags = function() {\n    let root = jQuery(REGION.AREA);\n    root.find('span.draghome').not('.dragplaceholder').each(function(i, dragNode) {\n        let drag = jQuery(dragNode),\n            currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n        drag.addClass('unplaced')\n            .removeClass('placed');\n        drag.removeAttr('tabindex');\n        if (currentPlace !== null) {\n            drag.removeClass('inplace' + currentPlace);\n        }\n    });\n    root.find('input.placeinput').each(function(i, inputNode) {\n        let input = jQuery(inputNode),\n            choice = input.val(),\n            place = Ddwtos.prototype.getPlace(input);\n        let drop = root.find('.drop.place' + place),\n            dropPosition = drop.offset();\n        drop.data('prev-top', dropPosition.top).data('prev-left', dropPosition.left);\n\n        if (choice === '0') {\n            return;\n        }\n        let unplacedDrag = Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input), choice);\n        let hiddenDrag = Ddwtos.prototype.getDragClone(unplacedDrag);\n        if (hiddenDrag.length) {\n            if (unplacedDrag.hasClass('infinite')) {\n                let noOfDrags = Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(unplacedDrag));\n                let cloneDrags = Ddwtos.prototype.getInfiniteDragClones(unplacedDrag, false);\n                if (cloneDrags.length < noOfDrags) {\n                    let cloneDrag = unplacedDrag.clone();\n                    hiddenDrag.after(cloneDrag);\n                    questionManager.addEventHandlersToDrag(cloneDrag);\n                } else {\n                    hiddenDrag.addClass('active');\n                }\n            } else {\n                hiddenDrag.addClass('active');\n            }\n        }\n        // Send the drag to drop.\n        Ddwtos.prototype.sendDragToDrop(Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input), choice), drop);\n    });\n\n    // Save the question answer.\n    Ddwtos.prototype.questionAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n};\n\nDdwtos.prototype.handleDragMoved = function(e, drag, target) {\n    drag.removeClass('beingdragged');\n    drag.css('top', '').css('left', '');\n    target.after(drag);\n    target.removeClass('active');\n    if (typeof drag.data('unplaced') !== 'undefined' && drag.data('unplaced') === true) {\n        drag.removeClass('placed').addClass('unplaced');\n        drag.removeAttr('tabindex');\n        drag.removeData('unplaced');\n        if (drag.hasClass('infinite') && Ddwtos.prototype.getInfiniteDragClones(drag, true).length > 1) {\n            Ddwtos.prototype.getInfiniteDragClones(drag, true).first().remove();\n        }\n    }\n    if (typeof drag.data('isfocus') !== 'undefined' && drag.data('isfocus') === true) {\n        drag.focus();\n        drag.removeData('isfocus');\n    }\n    if (typeof target.data('isfocus') !== 'undefined' && target.data('isfocus') === true) {\n        target.removeData('isfocus');\n    }\n    if (Ddwtos.prototype.isQuestionInteracted()) {\n        Ddwtos.prototype.questionAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n    }\n};\n\nDdwtos.prototype.isPointInDrop = function(pageX, pageY, drop) {\n    let position = drop.offset();\n    return pageX >= position.left && pageX < position.left + drop.width()\n        && pageY >= position.top && pageY < position.top + drop.height();\n};\n\nDdwtos.prototype.sendDragToDrop = function(drag, drop) {\n    let oldDrag = Ddwtos.prototype.getCurrentDragInPlace(Ddwtos.prototype.getPlace(drop));\n    if (oldDrag.length !== 0) {\n        let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(oldDrag, 'inplace');\n        let hiddenDrop = Ddwtos.prototype.getDrop(oldDrag, currentPlace);\n        hiddenDrop.addClass('active');\n        oldDrag.addClass('beingdragged');\n        oldDrag.offset(hiddenDrop.offset());\n        Ddwtos.prototype.sendDragHome(oldDrag);\n    }\n\n    if (drag.length === 0) {\n        Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop), 0);\n        if (drop.data('isfocus')) {\n            drop.focus();\n        }\n    } else {\n        // Prevent the drag item drop into two drop-zone.\n        if (Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace')) {\n            return;\n        }\n\n        Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop), Ddwtos.prototype.getChoice(drag));\n        drag.removeClass('unplaced')\n            .addClass('placed inplace' + Ddwtos.prototype.getPlace(drop));\n        drag.attr('tabindex', 0);\n        Ddwtos.prototype.animateTo(drag, drop);\n    }\n};\n\nDdwtos.prototype.sendDragHome = function(drag) {\n    let currentPlace = Ddwtos.prototype.getClassnameNumericSuffix(drag, 'inplace');\n    if (currentPlace !== null) {\n        drag.removeClass('inplace' + currentPlace);\n    }\n    drag.data('unplaced', true);\n\n    Ddwtos.prototype.animateTo(\n        drag,\n        Ddwtos.prototype.getDragHome(Ddwtos.prototype.getGroup(drag),\n            Ddwtos.prototype.getChoice(drag))\n    );\n};\n\nDdwtos.prototype.getPlace = function(node) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(node, 'place');\n};\n\nDdwtos.prototype.getQuestionAnsweredValues = function() {\n    let result = {};\n    jQuery(REGION.AREA).find('input.placeinput').each((i, inputNode) => {\n        result[inputNode.id] = inputNode.value;\n    });\n\n    return result;\n};\n\nDdwtos.prototype.animateTo = function(drag, target) {\n    if (target !== undefined) {\n        let currentPos = drag.offset(),\n            targetPos = target.offset(),\n            thisQ = this;\n        if (targetPos !== undefined) {\n            drag.animate(\n                {\n                    left: parseInt(drag.css('left')) + targetPos.left - currentPos.left,\n                    top: parseInt(drag.css('top')) + targetPos.top - currentPos.top\n                },\n                {\n                    duration: 'fast',\n                    done: function() {\n                        jQuery('body').trigger('qtype_ddwtos-dragmoved', [drag, target, thisQ]);\n                    }\n                }\n            );\n        }\n    }\n};\n\nDdwtos.prototype.getDragHome = function(group, choice) {\n    if (!jQuery(REGION.AREA).find('.draghome.dragplaceholder.group' + group + '.choice' + choice).is(':visible')) {\n        return jQuery(REGION.AREA).find('.draggrouphomes' + group +\n            ' span.draghome.infinite' +\n            '.choice' + choice +\n            '.group' + group);\n    }\n    return jQuery(REGION.AREA).find('.draghome.dragplaceholder.group' + group + '.choice' + choice);\n};\n\nDdwtos.prototype.getCurrentDragInPlace = function(place) {\n    return jQuery(REGION.AREA).find('span.draghome.inplace' + place);\n};\n\nDdwtos.prototype.resizeAllDragsAndDropsInGroup = function(group) {\n    let thisQ = this,\n        dragHomes = jQuery(REGION.AREA).find('.draggrouphomes' + group + ' span.draghome'),\n        maxWidth = 0,\n        maxHeight = 0;\n    dragHomes.each(function(i, drag) {\n        maxWidth = Math.max(maxWidth, Math.ceil(drag.offsetWidth));\n        maxHeight = Math.max(maxHeight, Math.ceil(0 + drag.offsetHeight));\n    });\n    maxWidth += 8;\n    maxHeight += 2;\n    dragHomes.each(function(i, drag) {\n        thisQ.setElementSize(drag, maxWidth, maxHeight);\n    });\n    jQuery(REGION.AREA).find('span.drop.group' + group).each(function(i, drop) {\n        thisQ.setElementSize(drop, maxWidth, maxHeight);\n    });\n};\n\nDdwtos.prototype.setElementSize = function(element, width, height) {\n    jQuery(element).width(width).height(height).css('lineHeight', height + 'px');\n};\n\nDdwtos.prototype.getClassnameNumericSuffix = function(node, prefix) {\n    let classes = node.attr('class');\n    if (classes !== '' && classes !== undefined) {\n        let classesArr = classes.split(' ');\n        for (let index = 0; index < classesArr.length; index++) {\n            let patt1 = new RegExp('^' + prefix + '([0-9])+$');\n            if (patt1.test(classesArr[index])) {\n                let patt2 = new RegExp('([0-9])+$');\n                let match = patt2.exec(classesArr[index]);\n                return Number(match[0]);\n            }\n        }\n    }\n    return null;\n};\n\nDdwtos.prototype.setInputValue = function(place, choice) {\n    jQuery(REGION.AREA).find('input.placeinput.place' + place).val(choice);\n};\n\nDdwtos.prototype.getDrop = function(drag, currentPlace) {\n    return jQuery(REGION.AREA).find('.drop.group' + Ddwtos.prototype.getGroup(drag) + '.place' + currentPlace);\n};\n\nDdwtos.prototype.getGroup = function(node) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(node, 'group');\n};\n\nDdwtos.prototype.getDragClone = function(drag) {\n    return jQuery(REGION.AREA).find('.draggrouphomes' +\n        Ddwtos.prototype.getGroup(drag) +\n        ' span.draghome' +\n        '.choice' + Ddwtos.prototype.getChoice(drag) +\n        '.group' + Ddwtos.prototype.getGroup(drag) +\n        '.dragplaceholder');\n};\n\nDdwtos.prototype.getChoice = function(drag) {\n    return Ddwtos.prototype.getClassnameNumericSuffix(drag, 'choice');\n};\n\nDdwtos.prototype.noOfDropsInGroup = function(group) {\n    return jQuery(REGION.AREA).find('.drop.group' + group).length;\n};\n\nDdwtos.prototype.getInfiniteDragClones = function(drag, inHome) {\n    if (inHome) {\n        return jQuery(REGION.AREA).find('.draggrouphomes' +\n            Ddwtos.prototype.getGroup(drag) +\n            ' span.draghome' +\n            '.choice' + Ddwtos.prototype.getChoice(drag) +\n            '.group' + Ddwtos.prototype.getGroup(drag) +\n            '.infinite').not('.dragplaceholder');\n    }\n    return jQuery(REGION.AREA).find('span.draghome' +\n        '.choice' + Ddwtos.prototype.getChoice(drag) +\n        '.group' + Ddwtos.prototype.getGroup(drag) +\n        '.infinite').not('.dragplaceholder');\n};\n\nDdwtos.prototype.dragMove = function(pageX, pageY, drag) {\n    jQuery(REGION.AREA).find('span.group' + Ddwtos.prototype.getGroup(drag)).not('.beingdragged').each(function(i, dropNode) {\n        let drop = jQuery(dropNode);\n        if (Ddwtos.prototype.isPointInDrop(pageX, pageY, drop)) {\n            drop.addClass('valid-drag-over-drop');\n        } else {\n            drop.removeClass('valid-drag-over-drop');\n        }\n    });\n};\n\nDdwtos.prototype.dragEnd = function(pageX, pageY, drag) {\n    let root = jQuery(REGION.AREA);\n    let placed = false;\n    root.find('span.group' + Ddwtos.prototype.getGroup(drag)).not('.beingdragged').each(function(i, dropNode) {\n        if (placed) {\n            return false;\n        }\n        const dropZone = jQuery(dropNode);\n        if (!Ddwtos.prototype.isPointInDrop(pageX, pageY, dropZone)) {\n            // Not this drop zone.\n            return true;\n        }\n        let drop = null;\n        if (dropZone.hasClass('placed')) {\n            // This is an placed drag item in a drop.\n            dropZone.removeClass('valid-drag-over-drop');\n            // Get the correct drop.\n            drop = Ddwtos.prototype.getDrop(drag, Ddwtos.prototype.getClassnameNumericSuffix(dropZone, 'inplace'));\n        } else {\n            // Empty drop.\n            drop = dropZone;\n        }\n        if (drop.hasClass('draghome')) {\n            // Not this drop zone.\n            return true;\n        }\n        // Now put this drag into the drop.\n        drop.removeClass('valid-drag-over-drop');\n        Ddwtos.prototype.sendDragToDrop(drag, drop);\n        placed = true;\n        return false; // Stop the each() here.\n    });\n    if (!placed) {\n        Ddwtos.prototype.sendDragHome(drag);\n    }\n};\n\nDdwtos.prototype.isQuestionInteracted = function() {\n    const oldAnswer = Ddwtos.prototype.questionAnswer;\n    const newAnswer = Ddwtos.prototype.getQuestionAnsweredValues();\n    let isInteracted = false;\n\n    // First, check both answers have the same structure or not.\n    if (JSON.stringify(newAnswer) !== JSON.stringify(oldAnswer)) {\n        isInteracted = true;\n        return isInteracted;\n    }\n    // Check the values.\n    Object.keys(newAnswer).forEach(key => {\n        if (newAnswer[key] !== oldAnswer[key]) {\n            isInteracted = true;\n        }\n    });\n\n    return isInteracted;\n};\n\nDdwtos.prototype.getUnplacedChoice = function(group, choice) {\n    return jQuery(REGION.AREA).find('.draghome.group' + group + '.choice' + choice + '.unplaced').slice(0, 1);\n};\n\nlet questionManager = {\n    eventHandlersInitialised: false,\n    dragEventHandlersInitialised: {},\n    isKeyboardNavigation: false,\n    questions: {},\n\n    /**\n     * Initialise questions.\n     *\n     * @param {String} containerId id of the outer div for this question.\n     */\n    init: function(containerId) {\n        questionManager.questions[containerId] = Ddwtos.prototype;\n        if (!questionManager.eventHandlersInitialised) {\n            questionManager.setupEventHandlers();\n            questionManager.eventHandlersInitialised = true;\n        }\n        if (!questionManager.dragEventHandlersInitialised.hasOwnProperty(containerId)) {\n            questionManager.dragEventHandlersInitialised[containerId] = true;\n            // We do not use the body event here to prevent the other event on Mobile device, such as scroll event.\n            let questionContainer = document.getElementById(containerId);\n            if (questionContainer.classList.contains('ddwtos') &&\n                !questionContainer.classList.contains('qtype_ddwtos-readonly')) {\n            }\n        }\n    },\n\n    setupEventHandlers: function() {\n        jQuery('body').on('qtype_ddwtos-dragmoved', Ddwtos.prototype.handleDragMoved.bind(this));\n    },\n\n    /**\n     * Binding the drag/touch event again for newly created element.\n     *\n     * @param {jQuery} element Element to bind the event\n     */\n    addEventHandlersToDrag: function(element) {\n        // Unbind all the mousedown and touchstart events to prevent double binding.\n        element.unbind('mousedown touchstart');\n        element.on('mousedown touchstart', Ddwtos.prototype.handleDragStart);\n    },\n\n    /**\n     * Given an event, work out which question it affects.\n     *\n     * @param {Event} e the event.\n     * @returns {DragDropToTextQuestion|undefined} The question, or undefined.\n     */\n    getQuestionForEvent: function(e) {\n        let containerId = jQuery(e.currentTarget).closest('.que.ddwtos').attr('id');\n        return questionManager.questions[containerId];\n    }\n};\n\nexport const initDdwtos = (selector, showquestionfeedback, manualmode, jsonresponse) => {\n    return new Ddwtos(selector, showquestionfeedback, manualmode, jsonresponse);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","initDdwtos","_jquery","_ajax","_templates","_notification","_event","_dragdrop","cmId","sId","questionid","kuetId","kid","ACTION","SEND_RESPONSE","REGION","ROOT","LOADING","NEXT","TIMER","SECONDS","CONTENTFEEDBACKS","FEEDBACK","FEEDBACKANSWER","FEEDBACKBACGROUND","AREA","DRAGHOME","DRAGELEMENT","DROPELEMENT","INPUTPLACE","STATEMENTTEXT","STATEMENTTEXT_CONTENT","ICONSANSWERS","ANSWERSCONTENT","ANSWERSCONTENTGROUP","MODALBODY","SERVICES","TEMPLATES","questionEnd","showQuestionFeedback","manualMode","Ddwtos","selector","showquestionfeedback","arguments","length","undefined","manualmode","jsonresponse","this","node","jQuery","attr","answered","showFeedback","showAnswers","setTimeout","prototype","questionManager","init","endTimer","Event","studentQuestionEnd","questionAnswer","on","reply","hasClass","document","querySelectorAll","forEach","element","draghomes","Array","slice","call","getElementsByClassName","drag","removeChild","shuffleArray","appendChild","initEvents","resizeAllDragsAndDrops","cloneDrags","positionDrags","initDragAndDrop","array","i","j","Math","floor","random","temp","addEventListener","once","ev","data","detail","userid","css","padding","show","e","statistics","statistic","correct","width","html","failure","invalid","noresponse","partially","pauseQuestion","playQuestion","hideAnswers","showStatistics","hideStatistics","hideFeedback","removeEvents","window","onbeforeunload","display","removeEventListener","Templates","render","visible","done","append","dispatchEvent","inputPlaces","response","input","timeLeft","parseInt","text","request","methodname","args","sessionid","kuetid","cmid","timeleft","preview","JSON","stringify","Ajax","reply_status","alert","remove","fail","Notification","exception","dragElement","setAttribute","unbind","handleDragStart","bind","target","closest","dragDrop","prepare","start","addClass","currentPlace","getClassnameNumericSuffix","setInputValue","removeClass","hiddenDrop","getDrop","offset","hiddenDrag","getDragClone","noOfDrags","noOfDropsInGroup","getGroup","getInfiniteDragClones","cloneDrag","clone","after","addEventHandlersToDrag","x","y","dragMove","dragEnd","fromService","hasfeedbacks","statment_feedback","answer_feedback","decodeURIComponent","escape","atob","question_text_feedback","off","querySelector","mEvent","notifyFilterContentUpdated","REPLY","thisQ","find","each","resizeAllDragsAndDropsInGroup","index","draghome","placeHolder","getChoice","before","root","not","dragNode","removeAttr","inputNode","choice","val","place","getPlace","drop","dropPosition","top","left","unplacedDrag","getUnplacedChoice","sendDragToDrop","getQuestionAnsweredValues","handleDragMoved","removeData","first","focus","isQuestionInteracted","isPointInDrop","pageX","pageY","position","height","oldDrag","getCurrentDragInPlace","sendDragHome","animateTo","getDragHome","result","id","currentPos","targetPos","animate","duration","trigger","group","is","dragHomes","maxWidth","maxHeight","max","ceil","offsetWidth","offsetHeight","setElementSize","prefix","classes","classesArr","split","RegExp","test","match","exec","Number","inHome","dropNode","placed","dropZone","oldAnswer","newAnswer","isInteracted","keys","key","eventHandlersInitialised","dragEventHandlersInitialised","isKeyboardNavigation","questions","containerId","setupEventHandlers","hasOwnProperty","questionContainer","getElementById","classList","contains","getQuestionForEvent","currentTarget"],"mappings":"wMAwCqC,SAAAA,uBAAAC,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA,CARxBG,OAAAC,eAAAC,SAAA,aAAA,CAAAC,OAAA,IAAAD,SAAAE,gBAAA,EAEbC,QAAAT,uBAAAS,SACAC,MAAAV,uBAAAU,OACAC,WAAAX,uBAAAW,YACAC,cAAAZ,uBAAAY,eACAC,OAAAb,uBAAAa,QAEAC,UAAAd,uBAAAc,WAEA,IAmCIC,KACAC,IACAC,WACAC,OACAC,IAvCAC,OAAS,CACTC,cAAe,iCAGfC,OAAS,CACTC,KAAM,mCACNC,QAAS,yCACTC,KAAM,gCACNC,MAAO,iCACPC,QAAS,0BACTC,iBAAkB,qCAClBC,SAAU,qCACVC,eAAgB,kCAChBC,kBAAmB,sCACnBC,KAAM,sBACNC,SAAU,YACVC,YAAa,6BACbC,YAAa,eACbC,WAAY,cACZC,cAAe,iCACfC,sBAAuB,iDACvBC,aAAc,wCACdC,eAAgB,mBAChBC,oBAAqB,6CACrBC,UAAW,eAGXC,eACO,kBAGPC,kBACS,uBAQTC,aAAc,EACdC,sBAAuB,EACvBC,YAAa,EAejB,SAASC,OAAOC,UAA+E,IAArEC,qBAAoBC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAAUG,WAAUH,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAAUI,aAAYJ,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GACvFK,KAAKC,MAAO,EAAAC,QAAMvD,SAAC8C,UACnBjC,IAAMwC,KAAKC,KAAKE,KAAK,YACrB5C,KAAOyC,KAAKC,KAAKE,KAAK,aACtB1C,WAAauC,KAAKC,KAAKE,KAAK,mBAC5BzC,OAASsC,KAAKC,KAAKE,KAAK,eACxBxC,IAAMqC,KAAKC,KAAKE,KAAK,YACrBb,qBAAuBI,qBACvBH,WAAaO,WACbT,aAAc,EACO,KAAjBU,eACAC,KAAKI,SAASL,cAAc,KACT,IAAfR,aAAwB,EAAAW,QAAAA,SAAOpC,OAAOoB,WAAWU,UACjDP,aAAc,GACe,IAAzBC,sBACAU,KAAKK,eAETL,KAAKM,iBAGT,EAAAJ,iBAAOpC,OAAOoB,WAAWU,OACzBW,YAAW,WACPf,OAAOgB,UAAUxD,YACpB,GAAE,KAEHwC,OAAOgB,UAAUxD,aAErByD,gBAAgBC,KAAK,qBACzB,CAxCAlB,OAAOgB,UAAUP,KAAO,KACxBT,OAAOgB,UAAUG,SAAW,IAAIC,MAAM,YACtCpB,OAAOgB,UAAUK,mBAAqB,IAAID,MAAM,sBAChDpB,OAAOgB,UAAUM,eAAiB,GAuClCtB,OAAOgB,UAAUxD,WAAa,aAC1B,EAAAkD,iBAAOtC,OAAOC,eAAekD,GAAG,QAASvB,OAAOgB,UAAUQ,QACtD,EAAAd,QAAAA,SAAOpC,OAAOgB,uBAAuBmC,SAAS,mBACjCC,SAASC,iBAAiBrD,OAAOmB,qBACvCmC,SAAQ,SAASC,SACpB,IAAIC,UAAYC,MAAMf,UAAUgB,MAAMC,KAAKJ,QAAQK,uBAAuB,aAC1EJ,UAAUF,SAAQ,SAASO,MACvBN,QAAQO,YAAYD,KACxB,IACAnC,OAAOgB,UAAUqB,aAAaP,WAC9BA,UAAUF,SAAQ,SAASO,MACvBN,QAAQS,YAAYH,KACxB,GACJ,IAEJnC,OAAOgB,UAAUuB,aACjBvC,OAAOgB,UAAUwB,yBACjBxC,OAAOgB,UAAUyB,aACjBzC,OAAOgB,UAAU0B,iBACG,IAAhB7C,aACAG,OAAOgB,UAAU2B,mBAIzB3C,OAAOgB,UAAUqB,aAAe,SAASO,OACrC,IAAK,IAAIC,EAAID,MAAMxC,OAAS,EAAGyC,EAAI,EAAGA,IAAK,CACvC,IAAIC,EAAIC,KAAKC,MAAMD,KAAKE,UAAYJ,EAAI,IACpCK,KAAON,MAAMC,GACjBD,MAAMC,GAAKD,MAAME,GACjBF,MAAME,GAAKI,IACf,CACA,OAAON,OAGX5C,OAAOgB,UAAUuB,WAAa,WAC1BY,iBAAiB,aAAcnD,OAAOgB,UAAUQ,MAAO,CAAC4B,MAAM,KAC3C,IAAfrD,aACAoD,iBAAiB,mBAAqBhF,KAAK,SAACkF,KAC1B,EAAA3C,QAAMvD,SAAC,kCAAkCmG,KAAK,WAC9CD,GAAGE,OAAOC,UACpB,EAAA9C,iBAAO,iCAAiC+C,IAAI,CAAC,UAAW,EAAGC,QAAW,UACtE,EAAAhD,iBAAO,iCAAiCiD,SAExB,IAAhB9D,aACAG,OAAOgB,UAAUQ,OAEzB,GAAG,CAAC4B,MAAM,IACVD,iBAAiB,sBAAwBhF,KAAK,SAACyF,IACvB,IAAhB/D,aACAG,OAAOgB,UAAUQ,QAErBoC,EAAEL,OAAOM,WAAWjC,SAAQ,SAACkC,YACzB,EAAApD,QAAMvD,SAAC,wBAAwBwD,KAAK,gBAAiBmD,UAAUC,SAC1DC,MAAMF,UAAUC,QAAU,KAAKE,KAAKH,UAAUC,QAAU,MAC7D,EAAArD,QAAMvD,SAAC,wBAAwBwD,KAAK,gBAAiBmD,UAAUI,SAC1DF,MAAMF,UAAUI,QAAU,KAAKD,KAAKH,UAAUI,QAAU,MAC7D,EAAAxD,QAAMvD,SAAC,wBAAwBwD,KAAK,gBAAiBmD,UAAUK,SAC1DH,MAAMF,UAAUK,QAAU,KAAKF,KAAKH,UAAUK,QAAU,MAC7D,EAAAzD,QAAMvD,SAAC,2BAA2BwD,KAAK,gBAAiBmD,UAAUM,YAC7DJ,MAAMF,UAAUM,WAAa,KAAKH,KAAKH,UAAUM,WAAa,MACnE,EAAA1D,QAAMvD,SAAC,0BAA0BwD,KAAK,gBAAiBmD,UAAUO,WAC5DL,MAAMF,UAAUO,UAAY,KAAKJ,KAAKH,UAAUO,UAAY,IACrE,GACJ,GAAG,CAACjB,MAAM,IACVD,iBAAiB,iBAAmBhF,KAAK,WACrC6B,OAAOgB,UAAUsD,eACpB,IAAE,GACHnB,iBAAiB,gBAAkBhF,KAAK,WACpC6B,OAAOgB,UAAUuD,cACpB,IAAE,GACHpB,iBAAiB,eAAiBhF,KAAK,WACnC6B,OAAOgB,UAAUF,aACpB,IAAE,GACHqC,iBAAiB,eAAiBhF,KAAK,WACnC6B,OAAOgB,UAAUwD,aACpB,IAAE,GACHrB,iBAAiB,kBAAoBhF,KAAK,WACtC6B,OAAOgB,UAAUyD,gBACpB,IAAE,GACHtB,iBAAiB,kBAAoBhF,KAAK,WACtC6B,OAAOgB,UAAU0D,gBACpB,IAAE,GACHvB,iBAAiB,gBAAkBhF,KAAK,WACpC6B,OAAOgB,UAAUH,cACpB,IAAE,GACHsC,iBAAiB,gBAAkBhF,KAAK,WACpC6B,OAAOgB,UAAU2D,cACpB,IAAE,GACHxB,iBAAiB,gBAAgB,WAC7BnD,OAAOgB,UAAU4D,cACrB,GAAG,CAACxB,MAAM,KAGdyB,OAAOC,eAAiB,WACpB,IAAI,EAAApE,QAAAA,SAAOpC,OAAOK,SAASyB,OAAS,IAAqB,IAAhBP,YAErC,OADAG,OAAOgB,UAAUQ,QACV,2HAMnBxB,OAAOgB,UAAUyD,eAAiB,YACV,IAAhB5E,cACA,EAAAa,iBAAO,eAAe+C,IAAI,CAACsB,QAAW,QAAS,UAAW,KAIlE/E,OAAOgB,UAAU0D,eAAiB,YACV,IAAhB7E,cACA,EAAAa,iBAAO,eAAe+C,IAAI,CAACsB,QAAW,OAAQ,UAAW,KAIjE/E,OAAOgB,UAAU4D,aAAe,WAC5BI,oBAAoB,aAAchF,OAAOgB,UAAUQ,MAAO,CAAC4B,MAAM,KAC9C,IAAfrD,aACAiF,oBAAoB,mBAAqB7G,KAAK,SAACkF,KAC7B,EAAA3C,QAAMvD,SAAC,kCAAkCmG,KAAK,WAC9CD,GAAGE,OAAOC,UACpB,EAAA9C,iBAAO,iCAAiC+C,IAAI,CAAC,UAAW,EAAGC,QAAW,UACtE,EAAAhD,iBAAO,iCAAiCiD,SAExB,IAAhB9D,aACAG,OAAOgB,UAAUQ,OAEzB,GAAG,CAAC4B,MAAM,IACV4B,oBAAoB,sBAAwB7G,KAAK,SAACyF,IAC1B,IAAhB/D,aACAG,OAAOgB,UAAUQ,QAErBoC,EAAEL,OAAOM,WAAWjC,SAAQ,SAACkC,YACzB,EAAApD,QAAMvD,SAAC,wBAAwBwD,KAAK,gBAAiBmD,UAAUC,SAC1DC,MAAMF,UAAUC,QAAU,KAAKE,KAAKH,UAAUC,QAAU,MAC7D,EAAArD,QAAMvD,SAAC,wBAAwBwD,KAAK,gBAAiBmD,UAAUI,SAC1DF,MAAMF,UAAUI,QAAU,KAAKD,KAAKH,UAAUI,QAAU,MAC7D,EAAAxD,QAAMvD,SAAC,wBAAwBwD,KAAK,gBAAiBmD,UAAUK,SAC1DH,MAAMF,UAAUK,QAAU,KAAKF,KAAKH,UAAUK,QAAU,MAC7D,EAAAzD,QAAMvD,SAAC,2BAA2BwD,KAAK,gBAAiBmD,UAAUM,YAC7DJ,MAAMF,UAAUM,WAAa,KAAKH,KAAKH,UAAUM,WAAa,MACnE,EAAA1D,QAAMvD,SAAC,0BAA0BwD,KAAK,gBAAiBmD,UAAUO,WAC5DL,MAAMF,UAAUO,UAAY,KAAKJ,KAAKH,UAAUO,UAAY,IACrE,GACJ,GAAG,CAACjB,MAAM,IACV4B,oBAAoB,iBAAmB7G,KAAK,WACxC6B,OAAOgB,UAAUsD,eACpB,IAAE,GACHU,oBAAoB,gBAAkB7G,KAAK,WACvC6B,OAAOgB,UAAUuD,cACpB,IAAE,GACHS,oBAAoB,eAAiB7G,KAAK,WACtC6B,OAAOgB,UAAUF,aACpB,IAAE,GACHkE,oBAAoB,eAAiB7G,KAAK,WACtC6B,OAAOgB,UAAUwD,aACpB,IAAE,GACHQ,oBAAoB,kBAAoB7G,KAAK,WACzC6B,OAAOgB,UAAUyD,gBACpB,IAAE,GACHO,oBAAoB,kBAAoB7G,KAAK,WACzC6B,OAAOgB,UAAU0D,gBACpB,IAAE,GACHM,oBAAoB,gBAAkB7G,KAAK,WACvC6B,OAAOgB,UAAUH,cACpB,IAAE,GACHmE,oBAAoB,gBAAkB7G,KAAK,WACvC6B,OAAOgB,UAAU2D,cACpB,IAAE,GACHK,oBAAoB,gBAAgB,WAChChF,OAAOgB,UAAU4D,cACrB,GAAG,CAACxB,MAAM,MAIlBpD,OAAOgB,UAAUQ,MAAQ,WACrByD,WAAAA,QAAUC,OAAOtF,kBAAmB,CAACuF,SAAS,IAAOC,MAAK,SAASnB,OAC/D,EAAAvD,QAAAA,SAAOpC,OAAOC,MAAM8G,OAAOpB,MAC3BqB,cAActF,OAAOgB,UAAUG,UAC/B6D,oBAAoB,aAAchF,OAAOgB,UAAUQ,MAAO,CAAC4B,MAAM,IACjEpD,OAAOgB,UAAU4D,eACjB,IAAIW,YAAc7D,SAASC,iBAAiBrD,OAAOc,YAC/CoG,SAAW,CAAA,EACX3C,EAAI,EACR0C,YAAY3D,SAAQ,SAAS6D,OACzBD,SAAS,IAAM3C,GAAK4C,MAAMlI,MAC1BsF,GACJ,IACA,IAAI6C,SAAWC,UAAS,EAAAjF,QAAMvD,SAACmB,OAAOK,SAASiH,QAC3CC,QAAU,CACVC,WAAYnG,eACZoG,KAAM,CACFC,UAAWhI,IACXiI,OAAQ/H,OACRgI,KAAMnI,KACNE,WAAYA,WACZE,IAAKA,IACLgI,SAAUT,UAAY,EACtBU,SAAS,EACTZ,SAAUa,KAAKC,UAAUd,YAGjCe,MAAAA,QAAKtE,KAAK,CAAC4D,UAAU,GAAGT,MAAK,SAASI,WACJ,IAA1BA,SAASgB,cACT3G,aAAc,EACdG,OAAOgB,UAAUJ,SAAS4E,UAAU,GACpCF,cAActF,OAAOgB,UAAUK,sBAC3B,EAAAX,QAAMvD,SAAC,eAAeiD,SAMH,IAAfL,cALJC,OAAOgB,UAAUF,eACY,IAAzBhB,sBACAE,OAAOgB,UAAUH,iBAWzB4F,MAAM,UAEV,EAAA/F,QAAAA,SAAOpC,OAAOE,SAASkI,QAC1B,IAAEC,KAAKC,cAAYzJ,QAAC0J,UACzB,KAIJ7G,OAAOgB,UAAU2B,gBAAkB,WACfjB,SAASC,iBAAiBrD,OAAOY,aACvC0C,SAAQ,SAASkF,aACvBA,YAAYC,aAAa,YAAa,UACtC,EAAArG,QAAAA,SAAOoG,aAAaE,OAAO,yBAC3B,EAAAtG,iBAAOoG,aAAavF,GAAG,uBAAwBvB,OAAOgB,UAAUiG,gBAAgBC,KAAK1G,MACzF,KAGJR,OAAOgB,UAAUiG,gBAAkB,SAASrD,GACxC,IAAIzB,MAAO,EAAAzB,QAAAA,SAAOkD,EAAEuD,QAAQC,QAAQ,aAEpC,GADWC,UAAAA,QAASC,QAAQ1D,GAClB2D,QAASpF,KAAKV,SAAS,gBAAjC,CAGAU,KAAKqF,SAAS,gBACd,IAAIC,aAAezH,OAAOgB,UAAU0G,0BAA0BvF,KAAM,WACpE,GAAqB,OAAjBsF,aAAuB,CACvBzH,OAAOgB,UAAU2G,cAAcF,aAAc,GAC7CtF,KAAKyF,YAAY,UAAYH,cAC7B,IAAII,WAAa7H,OAAOgB,UAAU8G,QAAQ3F,KAAMsF,cAC5CI,WAAWzH,SACXyH,WAAWL,SAAS,UACpBrF,KAAK4F,OAAOF,WAAWE,UAE/B,KAAO,CACH,IAAIC,WAAahI,OAAOgB,UAAUiH,aAAa9F,MAC/C,GAAI6F,WAAW5H,OACX,GAAI+B,KAAKV,SAAS,YAAa,CAC3B,IAAIyG,UAAYlI,OAAOgB,UAAUmH,iBAAiBnI,OAAOgB,UAAUoH,SAASjG,OAE5E,GADiBnC,OAAOgB,UAAUqH,sBAAsBlG,MAAM,GAC/C/B,OAAS8H,UAAW,CAC/B,IAAII,UAAYnG,KAAKoG,QACrBD,UAAUV,YAAY,gBACtBI,WAAWQ,MAAMF,WACjBrH,gBAAgBwH,uBAAuBH,WACvCnG,KAAK4F,OAAOO,UAAUP,SAC1B,MACIC,WAAWR,SAAS,UACpBrF,KAAK4F,OAAOC,WAAWD,SAE/B,MACIC,WAAWR,SAAS,UACpBrF,KAAK4F,OAAOC,WAAWD,SAGnC,CACAV,UAAAA,QAASE,MAAM3D,EAAGzB,MAAM,SAASuG,EAAGC,EAAGxG,MACnCnC,OAAOgB,UAAU4H,SAASF,EAAGC,EAAGxG,KACpC,IAAG,SAASuG,EAAGC,EAAGxG,MACdnC,OAAOgB,UAAU6H,QAAQH,EAAGC,EAAGxG,KACnC,GArCA,GA0CJnC,OAAOgB,UAAUJ,SAAW,SAAS4E,UAA+B,IAArBsD,YAAW3I,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GACtDN,aAAc,EACV2F,SAASuD,gBACT,EAAArI,QAAMvD,SAACmB,OAAOO,UAAUoF,KAAKuB,SAASwD,oBACtC,EAAAtI,QAAMvD,SAACmB,OAAOQ,gBAAgBmF,KAAKuB,SAASyD,mBAEhD,EAAAvI,QAAAA,SAAOtC,OAAOC,eAAemJ,SAAS,WACtC,EAAA9G,QAAMvD,SAACmB,OAAOS,mBAAmB0E,IAAI,UAAW,UAChD,EAAA/C,QAAAA,SAAOpC,OAAOe,eAAeoE,IAAI,CAAC,UAAW,EAAGC,QAAW,UAC3D,EAAAhD,QAAMvD,SAACmB,OAAOI,OAAO+E,IAAI,UAAW,IACjB,IAAf1D,aACA,EAAAW,QAAAA,SAAOpC,OAAOG,MAAMmJ,YAAY,WAEhB,IAAhBkB,eACA,EAAApI,QAAAA,SAAOpC,OAAOgB,uBAAuB2E,KAAKiF,mBAAmBC,OAAOC,KAAK5D,SAAS6D,2BAClFrJ,OAAOgB,UAAUwB,yBACjBxC,OAAOgB,UAAUyB,aACjBzC,OAAOgB,UAAU0B,iBAELhB,SAASC,iBAAiBrD,OAAOW,UACvC2C,SAAQ,SAASkF,aACvBA,YAAYC,aAAa,YAAa,UACtC,EAAArG,QAAAA,SAAOoG,aAAaE,OAAO,yBAC3B,EAAAtG,QAAAA,SAAOoG,aAAawC,IAAI,yBACxB,EAAA5I,iBAAOoG,aAAarD,IAAI,CAAC,iBAAkB,QAC/C,IAEyB,OADF/B,SAAS6H,cAAcjL,OAAOM,mBAEjD4K,OAAMrM,QAACsM,2BAA2B/H,SAAS6H,cAAcjL,OAAOM,oBAIxEoB,OAAOgB,UAAUsD,cAAgB,WAC7BgB,cAAc,IAAIlE,MAAM,mBACxB,EAAAV,QAAMvD,SAACmB,OAAOI,OAAO+E,IAAI,UAAW,IACpC,EAAA/C,QAAMvD,SAACmB,OAAOS,mBAAmB0E,IAAI,UAAW,UAChD,EAAA/C,QAAMvD,SAACiB,OAAOsL,OAAOjG,IAAI,iBAAkB,SAG/CzD,OAAOgB,UAAUuD,aAAe,YACR,IAAhB1E,cACAyF,cAAc,IAAIlE,MAAM,kBACxB,EAAAV,QAAMvD,SAACmB,OAAOI,OAAO+E,IAAI,UAAW,IACpC,EAAA/C,QAAMvD,SAACmB,OAAOS,mBAAmB0E,IAAI,UAAW,SAChD,EAAA/C,QAAMvD,SAACiB,OAAOsL,OAAOjG,IAAI,iBAAkB,UAInDzD,OAAOgB,UAAUH,aAAe,YACR,IAAhBhB,cACA,EAAAa,QAAAA,SAAOpC,OAAOM,kBAAkB6E,IAAI,CAACsB,QAAW,QAAS,UAAW,KAI5E/E,OAAOgB,UAAU2D,aAAe,YACR,IAAhB9E,cACA,EAAAa,QAAAA,SAAOpC,OAAOM,kBAAkB6E,IAAI,CAACsB,QAAW,OAAQ,UAAW,KAI3E/E,OAAOgB,UAAUF,YAAc,YACP,IAAhBjB,cACA,EAAAa,QAAAA,SAAOpC,OAAOiB,cAAckE,IAAI,CAACsB,QAAW,kBAIpD/E,OAAOgB,UAAUwD,YAAc,YACP,IAAhB3E,cACA,EAAAa,QAAAA,SAAOpC,OAAOiB,cAAckE,IAAI,CAACsB,QAAW,UAKpD/E,OAAOgB,UAAUwB,uBAAyB,WACtC,IAAImH,MAAQnJ,MACZ,EAAAE,iBAAOpC,OAAOU,MAAM4K,KAAK,0BAA0BC,MAAK,SAAShH,EAAGpC,MAChEkJ,MAAMG,8BACFH,MAAMjC,2BAA0B,EAAAhH,QAAAA,SAAOD,MAAO,kBACtD,KAGJT,OAAOgB,UAAUyB,WAAa,YAC1B,EAAA/B,iBAAOpC,OAAOU,MAAM4K,KAAK,iBAAiBC,MAAK,SAASE,MAAOC,UAC3D,IAAI7H,MAAO,EAAAzB,QAAMvD,SAAC6M,UACdC,YAAc9H,KAAKoG,QACvB0B,YAAYrC,cACZqC,YAAYzC,SAAS,kBACjBxH,OAAOgB,UAAUkJ,UAAU/H,MAAQ,SACnCnC,OAAOgB,UAAUoH,SAASjG,MAAQ,oBACtCA,KAAKgI,OAAOF,YAChB,KAGJjK,OAAOgB,UAAU0B,cAAgB,WAC7B,IAAI0H,MAAO,EAAA1J,QAAAA,SAAOpC,OAAOU,MACzBoL,KAAKR,KAAK,iBAAiBS,IAAI,oBAAoBR,MAAK,SAAShH,EAAGyH,UAChE,IAAInI,MAAO,EAAAzB,QAAMvD,SAACmN,UACd7C,aAAezH,OAAOgB,UAAU0G,0BAA0BvF,KAAM,WACpEA,KAAKqF,SAAS,YACTI,YAAY,UACjBzF,KAAKoI,WAAW,YACK,OAAjB9C,cACAtF,KAAKyF,YAAY,UAAYH,aAErC,IACA2C,KAAKR,KAAK,oBAAoBC,MAAK,SAAShH,EAAG2H,WAC3C,IAAI/E,OAAQ,EAAA/E,QAAMvD,SAACqN,WACfC,OAAShF,MAAMiF,MACfC,MAAQ3K,OAAOgB,UAAU4J,SAASnF,OAClCoF,KAAOT,KAAKR,KAAK,cAAgBe,OACjCG,aAAeD,KAAK9C,SAGxB,GAFA8C,KAAKvH,KAAK,WAAYwH,aAAaC,KAAKzH,KAAK,YAAawH,aAAaE,MAExD,MAAXP,OAAJ,CAGA,IAAIQ,aAAejL,OAAOgB,UAAUkK,kBAAkBlL,OAAOgB,UAAUoH,SAAS3C,OAAQgF,QACpFzC,WAAahI,OAAOgB,UAAUiH,aAAagD,cAC/C,GAAIjD,WAAW5H,OACX,GAAI6K,aAAaxJ,SAAS,YAAa,CACnC,IAAIyG,UAAYlI,OAAOgB,UAAUmH,iBAAiBnI,OAAOgB,UAAUoH,SAAS6C,eAE5E,GADiBjL,OAAOgB,UAAUqH,sBAAsB4C,cAAc,GACvD7K,OAAS8H,UAAW,CAC/B,IAAII,UAAY2C,aAAa1C,QAC7BP,WAAWQ,MAAMF,WACjBrH,gBAAgBwH,uBAAuBH,UAC3C,MACIN,WAAWR,SAAS,SAE5B,MACIQ,WAAWR,SAAS,UAI5BxH,OAAOgB,UAAUmK,eAAenL,OAAOgB,UAAUkK,kBAAkBlL,OAAOgB,UAAUoH,SAAS3C,OAAQgF,QAASI,KAnB9G,CAoBJ,IAGA7K,OAAOgB,UAAUM,eAAiBtB,OAAOgB,UAAUoK,6BAGvDpL,OAAOgB,UAAUqK,gBAAkB,SAASzH,EAAGzB,KAAMgF,QACjDhF,KAAKyF,YAAY,gBACjBzF,KAAKsB,IAAI,MAAO,IAAIA,IAAI,OAAQ,IAChC0D,OAAOqB,MAAMrG,MACbgF,OAAOS,YAAY,eACkB,IAA1BzF,KAAKmB,KAAK,cAAyD,IAA1BnB,KAAKmB,KAAK,cAC1DnB,KAAKyF,YAAY,UAAUJ,SAAS,YACpCrF,KAAKoI,WAAW,YAChBpI,KAAKmJ,WAAW,YACZnJ,KAAKV,SAAS,aAAezB,OAAOgB,UAAUqH,sBAAsBlG,MAAM,GAAM/B,OAAS,GACzFJ,OAAOgB,UAAUqH,sBAAsBlG,MAAM,GAAMoJ,QAAQ7E,eAG/B,IAAzBvE,KAAKmB,KAAK,aAAuD,IAAzBnB,KAAKmB,KAAK,aACzDnB,KAAKqJ,QACLrJ,KAAKmJ,WAAW,iBAEkB,IAA3BnE,OAAO7D,KAAK,aAAyD,IAA3B6D,OAAO7D,KAAK,YAC7D6D,OAAOmE,WAAW,WAElBtL,OAAOgB,UAAUyK,yBACjBzL,OAAOgB,UAAUM,eAAiBtB,OAAOgB,UAAUoK,8BAI3DpL,OAAOgB,UAAU0K,cAAgB,SAASC,MAAOC,MAAOf,MACpD,IAAIgB,SAAWhB,KAAK9C,SACpB,OAAO4D,OAASE,SAASb,MAAQW,MAAQE,SAASb,KAAOH,KAAK7G,SACvD4H,OAASC,SAASd,KAAOa,MAAQC,SAASd,IAAMF,KAAKiB,UAGhE9L,OAAOgB,UAAUmK,eAAiB,SAAShJ,KAAM0I,MAC7C,IAAIkB,QAAU/L,OAAOgB,UAAUgL,sBAAsBhM,OAAOgB,UAAU4J,SAASC,OAC/E,GAAuB,IAAnBkB,QAAQ3L,OAAc,CACtB,IAAIqH,aAAezH,OAAOgB,UAAU0G,0BAA0BqE,QAAS,WACnElE,WAAa7H,OAAOgB,UAAU8G,QAAQiE,QAAStE,cACnDI,WAAWL,SAAS,UACpBuE,QAAQvE,SAAS,gBACjBuE,QAAQhE,OAAOF,WAAWE,UAC1B/H,OAAOgB,UAAUiL,aAAaF,QAClC,CAEA,GAAoB,IAAhB5J,KAAK/B,OACLJ,OAAOgB,UAAU2G,cAAc3H,OAAOgB,UAAU4J,SAASC,MAAO,GAC5DA,KAAKvH,KAAK,YACVuH,KAAKW,YAEN,CAEH,GAAIxL,OAAOgB,UAAU0G,0BAA0BvF,KAAM,WACjD,OAGJnC,OAAOgB,UAAU2G,cAAc3H,OAAOgB,UAAU4J,SAASC,MAAO7K,OAAOgB,UAAUkJ,UAAU/H,OAC3FA,KAAKyF,YAAY,YACZJ,SAAS,iBAAmBxH,OAAOgB,UAAU4J,SAASC,OAC3D1I,KAAKxB,KAAK,WAAY,GACtBX,OAAOgB,UAAUkL,UAAU/J,KAAM0I,KACrC,GAGJ7K,OAAOgB,UAAUiL,aAAe,SAAS9J,MACrC,IAAIsF,aAAezH,OAAOgB,UAAU0G,0BAA0BvF,KAAM,WAC/C,OAAjBsF,cACAtF,KAAKyF,YAAY,UAAYH,cAEjCtF,KAAKmB,KAAK,YAAY,GAEtBtD,OAAOgB,UAAUkL,UACb/J,KACAnC,OAAOgB,UAAUmL,YAAYnM,OAAOgB,UAAUoH,SAASjG,MACnDnC,OAAOgB,UAAUkJ,UAAU/H,SAIvCnC,OAAOgB,UAAU4J,SAAW,SAASnK,MACjC,OAAOT,OAAOgB,UAAU0G,0BAA0BjH,KAAM,UAG5DT,OAAOgB,UAAUoK,0BAA4B,WACzC,IAAIgB,OAAS,CAAA,EAKb,OAJA,EAAA1L,iBAAOpC,OAAOU,MAAM4K,KAAK,oBAAoBC,MAAK,SAAChH,EAAG2H,WAClD4B,OAAO5B,UAAU6B,IAAM7B,UAAUjN,KACrC,IAEO6O,QAGXpM,OAAOgB,UAAUkL,UAAY,SAAS/J,KAAMgF,QACxC,QAAe9G,IAAX8G,OAAsB,CACtB,IAAImF,WAAanK,KAAK4F,SAClBwE,UAAYpF,OAAOY,SACnB4B,MAAQnJ,UACMH,IAAdkM,WACApK,KAAKqK,QACD,CACIxB,KAAMrF,SAASxD,KAAKsB,IAAI,SAAW8I,UAAUvB,KAAOsB,WAAWtB,KAC/DD,IAAKpF,SAASxD,KAAKsB,IAAI,QAAU8I,UAAUxB,IAAMuB,WAAWvB,KAEhE,CACI0B,SAAU,OACVrH,KAAM,YACF,EAAA1E,iBAAO,QAAQgM,QAAQ,yBAA0B,CAACvK,KAAMgF,OAAQwC,OACpE,GAIhB,GAGJ3J,OAAOgB,UAAUmL,YAAc,SAASQ,MAAOlC,QAC3C,OAAK,EAAA/J,QAAAA,SAAOpC,OAAOU,MAAM4K,KAAK,kCAAoC+C,MAAQ,UAAYlC,QAAQmC,GAAG,aAM1F,EAAAlM,QAAMvD,SAACmB,OAAOU,MAAM4K,KAAK,kCAAoC+C,MAAQ,UAAYlC,SAL7E,EAAA/J,iBAAOpC,OAAOU,MAAM4K,KAAK,kBAAoB+C,MAApB,iCAEhBlC,OACZ,SAAWkC,QAKvB3M,OAAOgB,UAAUgL,sBAAwB,SAASrB,OAC9C,OAAO,EAAAjK,QAAAA,SAAOpC,OAAOU,MAAM4K,KAAK,wBAA0Be,QAG9D3K,OAAOgB,UAAU8I,8BAAgC,SAAS6C,OACtD,IAAIhD,MAAQnJ,KACRqM,WAAY,EAAAnM,QAAAA,SAAOpC,OAAOU,MAAM4K,KAAK,kBAAoB+C,MAAQ,kBACjEG,SAAW,EACXC,UAAY,EAChBF,UAAUhD,MAAK,SAAShH,EAAGV,MACvB2K,SAAW/J,KAAKiK,IAAIF,SAAU/J,KAAKkK,KAAK9K,KAAK+K,cAC7CH,UAAYhK,KAAKiK,IAAID,UAAWhK,KAAKkK,KAAK,EAAI9K,KAAKgL,cACvD,IACAL,UAAY,EACZC,WAAa,EACbF,UAAUhD,MAAK,SAAShH,EAAGV,MACvBwH,MAAMyD,eAAejL,KAAM2K,SAAUC,UACzC,KACA,EAAArM,QAAAA,SAAOpC,OAAOU,MAAM4K,KAAK,kBAAoB+C,OAAO9C,MAAK,SAAShH,EAAGgI,MACjElB,MAAMyD,eAAevC,KAAMiC,SAAUC,UACzC,KAGJ/M,OAAOgB,UAAUoM,eAAiB,SAASvL,QAASmC,MAAO8H,SACvD,EAAApL,QAAAA,SAAOmB,SAASmC,MAAMA,OAAO8H,OAAOA,QAAQrI,IAAI,aAAcqI,OAAS,OAG3E9L,OAAOgB,UAAU0G,0BAA4B,SAASjH,KAAM4M,QACxD,IAAIC,QAAU7M,KAAKE,KAAK,SACxB,GAAgB,KAAZ2M,cAA8BjN,IAAZiN,QAElB,IADA,IAAIC,WAAaD,QAAQE,MAAM,KACtBzD,MAAQ,EAAGA,MAAQwD,WAAWnN,OAAQ2J,QAAS,CAEpD,GADY,IAAI0D,OAAO,IAAMJ,OAAS,aAC5BK,KAAKH,WAAWxD,QAAS,CAC/B,IACI4D,MADQ,IAAIF,OAAO,aACLG,KAAKL,WAAWxD,QAClC,OAAO8D,OAAOF,MAAM,GACxB,CACJ,CAEJ,OAAO,MAGX3N,OAAOgB,UAAU2G,cAAgB,SAASgD,MAAOF,SAC7C,EAAA/J,iBAAOpC,OAAOU,MAAM4K,KAAK,yBAA2Be,OAAOD,IAAID,SAGnEzK,OAAOgB,UAAU8G,QAAU,SAAS3F,KAAMsF,cACtC,OAAO,EAAA/G,QAAMvD,SAACmB,OAAOU,MAAM4K,KAAK,cAAgB5J,OAAOgB,UAAUoH,SAASjG,MAAQ,SAAWsF,eAGjGzH,OAAOgB,UAAUoH,SAAW,SAAS3H,MACjC,OAAOT,OAAOgB,UAAU0G,0BAA0BjH,KAAM,UAG5DT,OAAOgB,UAAUiH,aAAe,SAAS9F,MACrC,OAAO,EAAAzB,iBAAOpC,OAAOU,MAAM4K,KAAK,kBAC5B5J,OAAOgB,UAAUoH,SAASjG,MADE,wBAGhBnC,OAAOgB,UAAUkJ,UAAU/H,MACvC,SAAWnC,OAAOgB,UAAUoH,SAASjG,MACrC,qBAGRnC,OAAOgB,UAAUkJ,UAAY,SAAS/H,MAClC,OAAOnC,OAAOgB,UAAU0G,0BAA0BvF,KAAM,WAG5DnC,OAAOgB,UAAUmH,iBAAmB,SAASwE,OACzC,OAAO,EAAAjM,QAAAA,SAAOpC,OAAOU,MAAM4K,KAAK,cAAgB+C,OAAOvM,QAG3DJ,OAAOgB,UAAUqH,sBAAwB,SAASlG,KAAM2L,QACpD,OAAIA,QACO,EAAApN,iBAAOpC,OAAOU,MAAM4K,KAAK,kBAC5B5J,OAAOgB,UAAUoH,SAASjG,MADE,wBAGhBnC,OAAOgB,UAAUkJ,UAAU/H,MACvC,SAAWnC,OAAOgB,UAAUoH,SAASjG,MACrC,aAAakI,IAAI,qBAElB,EAAA3J,QAAMvD,SAACmB,OAAOU,MAAM4K,KAAK,uBAChB5J,OAAOgB,UAAUkJ,UAAU/H,MACvC,SAAWnC,OAAOgB,UAAUoH,SAASjG,MACrC,aAAakI,IAAI,qBAGzBrK,OAAOgB,UAAU4H,SAAW,SAAS+C,MAAOC,MAAOzJ,OAC/C,EAAAzB,QAAMvD,SAACmB,OAAOU,MAAM4K,KAAK,aAAe5J,OAAOgB,UAAUoH,SAASjG,OAAOkI,IAAI,iBAAiBR,MAAK,SAAShH,EAAGkL,UAC3G,IAAIlD,MAAO,EAAAnK,QAAMvD,SAAC4Q,UACd/N,OAAOgB,UAAU0K,cAAcC,MAAOC,MAAOf,MAC7CA,KAAKrD,SAAS,wBAEdqD,KAAKjD,YAAY,uBAEzB,KAGJ5H,OAAOgB,UAAU6H,QAAU,SAAS8C,MAAOC,MAAOzJ,MAC9C,IAAIiI,MAAO,EAAA1J,QAAAA,SAAOpC,OAAOU,MACrBgP,QAAS,EACb5D,KAAKR,KAAK,aAAe5J,OAAOgB,UAAUoH,SAASjG,OAAOkI,IAAI,iBAAiBR,MAAK,SAAShH,EAAGkL,UAC5F,GAAIC,OACA,OAAO,EAEX,IAAMC,UAAW,EAAAvN,QAAMvD,SAAC4Q,UACxB,IAAK/N,OAAOgB,UAAU0K,cAAcC,MAAOC,MAAOqC,UAE9C,OAAO,EAEX,IAAIpD,KAAO,KAUX,OATIoD,SAASxM,SAAS,WAElBwM,SAASrG,YAAY,wBAErBiD,KAAO7K,OAAOgB,UAAU8G,QAAQ3F,KAAMnC,OAAOgB,UAAU0G,0BAA0BuG,SAAU,aAG3FpD,KAAOoD,WAEPpD,KAAKpJ,SAAS,cAKlBoJ,KAAKjD,YAAY,wBACjB5H,OAAOgB,UAAUmK,eAAehJ,KAAM0I,MACtCmD,QAAS,GACF,EACX,IACKA,QACDhO,OAAOgB,UAAUiL,aAAa9J,OAItCnC,OAAOgB,UAAUyK,qBAAuB,WACpC,IAAMyC,UAAYlO,OAAOgB,UAAUM,eAC7B6M,UAAYnO,OAAOgB,UAAUoK,4BAC/BgD,cAAe,EAGnB,OAAI/H,KAAKC,UAAU6H,aAAe9H,KAAKC,UAAU4H,WAC7CE,cAAe,GAInBhR,OAAOiR,KAAKF,WAAWvM,SAAQ,SAAA0M,KACvBH,UAAUG,OAASJ,UAAUI,OAC7BF,cAAe,EAEvB,IAEOA,eAGXpO,OAAOgB,UAAUkK,kBAAoB,SAASyB,MAAOlC,QACjD,OAAO,EAAA/J,QAAMvD,SAACmB,OAAOU,MAAM4K,KAAK,kBAAoB+C,MAAQ,UAAYlC,OAAS,aAAazI,MAAM,EAAG,IAG3G,IAAIf,gBAAkB,CAClBsN,0BAA0B,EAC1BC,6BAA8B,CAAE,EAChCC,sBAAsB,EACtBC,UAAW,CAAE,EAObxN,KAAM,SAASyN,aAMX,GALA1N,gBAAgByN,UAAUC,aAAe3O,OAAOgB,UAC3CC,gBAAgBsN,2BACjBtN,gBAAgB2N,qBAChB3N,gBAAgBsN,0BAA2B,IAE1CtN,gBAAgBuN,6BAA6BK,eAAeF,aAAc,CAC3E1N,gBAAgBuN,6BAA6BG,cAAe,EAE5D,IAAIG,kBAAoBpN,SAASqN,eAAeJ,aAC5CG,kBAAkBE,UAAUC,SAAS,WACpCH,kBAAkBE,UAAUC,SAAS,wBAE9C,CACH,EAEDL,mBAAoB,YAChB,EAAAlO,iBAAO,QAAQa,GAAG,yBAA0BvB,OAAOgB,UAAUqK,gBAAgBnE,KAAK1G,MACrF,EAODiI,uBAAwB,SAAS5G,SAE7BA,QAAQmF,OAAO,wBACfnF,QAAQN,GAAG,uBAAwBvB,OAAOgB,UAAUiG,gBACvD,EAQDiI,oBAAqB,SAAStL,GAC1B,IAAI+K,aAAc,EAAAjO,iBAAOkD,EAAEuL,eAAe/H,QAAQ,eAAezG,KAAK,MACtE,OAAOM,gBAAgByN,UAAUC,YACrC,GAKFrR,SAAAE,WAFwB,SAACyC,SAAUC,qBAAsBI,WAAYC,cACnE,OAAO,IAAIP,OAAOC,SAAUC,qBAAsBI,WAAYC,cAChE"}