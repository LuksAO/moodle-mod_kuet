define("mod_jqshow/teacher_programmedmode",["exports","jquery","core/ajax","core/templates","core/notification","core/str","core/modal_factory","core/modal_events"],(function(_exports,_jquery,_ajax,_templates,_notification,_str,_modal_factory,_modal_events){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initProgrammedMode=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);var cmId,sId,REGION_LISTRESULTS='[data-region="list-results"]',REGION_RACERESULTS='[data-region="race-results"]',ACTION_ENDSESSION='[data-action="end_session"]',SERVICES_GETLISTRESULTS="mod_jqshow_getlistresults",SERVICES_GETGROUPLISTRESULTS="mod_jqshow_getgrouplistresults",SERVICES_GETRACERESULTS="mod_jqshow_getraceresults",SERVICES_FINISHSESSION="mod_jqshow_finishsession",TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_LISTRESULTS="mod_jqshow/session/listresults",TEMPLATES_RACERESULTS="mod_jqshow/session/raceresults",groupMode=!1;function ProgrammedMode(selector,racemode){this.node=(0,_jquery.default)(selector),this.initProgrammedMode(),(0,_jquery.default)(ACTION_ENDSESSION).on("click",this.finishSession),racemode&&(this.raceMode(),setInterval(this.reloadRace,5e3))}ProgrammedMode.prototype.node=null,ProgrammedMode.prototype.initProgrammedMode=function(){sId=this.node.attr("data-sid"),cmId=this.node.attr("data-cmid"),groupMode=Boolean(this.node.attr("data-groupmode")),setInterval(this.reloadList,2e4)},ProgrammedMode.prototype.reloadList=function(){_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){var identifier=(0,_jquery.default)(REGION_LISTRESULTS);identifier.append(html);var methodname=SERVICES_GETLISTRESULTS;!0===groupMode&&(methodname=SERVICES_GETGROUPLISTRESULTS);var request={methodname:methodname,args:{sid:sId,cmid:cmId}};_ajax.default.call([request])[0].done((function(response){_templates.default.render(TEMPLATES_LISTRESULTS,response).then((function(html){identifier.html(html)})).fail(_notification.default.exception)})).fail(_notification.default.exception)}))},ProgrammedMode.prototype.finishSession=function(e){e.preventDefault(),e.stopPropagation();(0,_str.get_strings)([{key:"end_session",component:"mod_jqshow"},{key:"end_session_desc",component:"mod_jqshow"},{key:"confirm",component:"mod_jqshow"}]).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2];return _modal_factory.default.create({title:title,body:confirmMessage,type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(function(){var request={methodname:SERVICES_FINISHSESSION,args:{cmid:cmId,sessionid:sId}};_ajax.default.call([request])[0].done((function(response){!0===response.finished&&window.location.replace(M.cfg.wwwroot+"/mod/jqshow/view.php?id="+cmId)})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(_notification.default.exception)},ProgrammedMode.prototype.raceMode=function(){var scrollUsers=document.querySelector("#content-users"),questions=document.querySelectorAll(".content-responses");scrollUsers.addEventListener("scroll",(function(){questions.forEach((function(question){question.scrollTop=scrollUsers.scrollTop}))}),{passive:!0})},ProgrammedMode.prototype.reloadRace=function(){var identifier=(0,_jquery.default)(REGION_RACERESULTS),request={methodname:SERVICES_GETRACERESULTS,args:{sid:sId,cmid:cmId}};_ajax.default.call([request])[0].done((function(response){response.programmedmode=!0,_templates.default.render(TEMPLATES_RACERESULTS,response).then((function(html){var scrollUsersTop=document.querySelector("#content-users").scrollTop,scrollQuestionsLeft=document.querySelector("#questions-list").scrollLeft;identifier.html(html);var newScrollUsers=document.querySelector("#content-users"),newScrollQuestions=document.querySelector("#questions-list");ProgrammedMode.prototype.raceMode(),newScrollUsers.scrollTop=scrollUsersTop,newScrollQuestions.scrollLeft=scrollQuestionsLeft})).fail(_notification.default.exception)})).fail(_notification.default.exception)};_exports.initProgrammedMode=function(selector){return new ProgrammedMode(selector,arguments.length>1&&void 0!==arguments[1]&&arguments[1])}}));

//# sourceMappingURL=teacher_programmedmode.min.js.map