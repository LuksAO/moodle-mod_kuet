define("mod_jqshow/ddwtos",["exports","jquery","core/ajax","core/templates","core/notification","core/event","core/dragdrop"],(function(_exports,_jquery,_ajax,_templates,_notification,_event,_dragdrop){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initDdwtos=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_event=_interopRequireDefault(_event),_dragdrop=_interopRequireDefault(_dragdrop);var cmId,sId,questionid,jqshowId,jqid,ACTION={SEND_RESPONSE:'[data-action="send-response"]'},REGION={ROOT:'[data-region="question-content"]',LOADING:'[data-region="overlay-icon-container"]',NEXT:'[data-action="next-question"]',TIMER:'[data-region="question-timer"]',SECONDS:'[data-region="seconds"]',CONTENTFEEDBACKS:'[data-region="containt-feedbacks"]',FEEDBACK:'[data-region="statement-feedback"]',FEEDBACKANSWER:'[data-region="answer-feedback"]',FEEDBACKBACGROUND:'[data-region="feedback-background"]',AREA:"#drag_and_drop_area",DRAGHOME:".draghome",DRAGELEMENT:".draghome.user-select-none",DROPELEMENT:".drop.active",INPUTPLACE:".placeinput",STATEMENTTEXT:'[data-region="statement-text"]',STATEMENTTEXT_CONTENT:'[data-region="statement-text"] .statement-text',ICONSANSWERS:".icon.text-success, .icon.text-danger",ANSWERSCONTENT:".answercontainer",ANSWERSCONTENTGROUP:'.answercontainer [class*="draggrouphomes"]',MODALBODY:".modal-body"},SERVICES_REPLY="mod_jqshow_ddwtos",TEMPLATES_LOADING="core/overlay_loading",questionEnd=!1,showQuestionFeedback=!1,manualMode=!1;function Ddwtos(selector){var showquestionfeedback=arguments.length>1&&void 0!==arguments[1]&&arguments[1],manualmode=arguments.length>2&&void 0!==arguments[2]&&arguments[2],jsonresponse=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.node=(0,_jquery.default)(selector),sId=this.node.attr("data-sid"),cmId=this.node.attr("data-cmid"),questionid=this.node.attr("data-questionid"),jqshowId=this.node.attr("data-jqshowid"),jqid=this.node.attr("data-jqid"),showQuestionFeedback=showquestionfeedback,manualMode=manualmode,questionEnd=!1,""!==jsonresponse&&(this.answered(jsonresponse,!1),(!1===manualMode||(0,_jquery.default)(REGION.MODALBODY).length)&&(questionEnd=!0,!0===showQuestionFeedback&&this.showFeedback(),this.showAnswers())),(0,_jquery.default)(REGION.MODALBODY).length?setTimeout((function(){Ddwtos.prototype.initDdwtos()}),500):Ddwtos.prototype.initDdwtos(),questionManager.init("drag_and_drop_area")}Ddwtos.prototype.node=null,Ddwtos.prototype.endTimer=new Event("endTimer"),Ddwtos.prototype.studentQuestionEnd=new Event("studentQuestionEnd"),Ddwtos.prototype.questionAnswer={},Ddwtos.prototype.initDdwtos=function(){((0,_jquery.default)(ACTION.SEND_RESPONSE).on("click",Ddwtos.prototype.reply),(0,_jquery.default)(REGION.STATEMENTTEXT_CONTENT).hasClass("randomanswers"))&&document.querySelectorAll(REGION.ANSWERSCONTENTGROUP).forEach((function(element){var draghomes=Array.prototype.slice.call(element.getElementsByClassName("draghome"));draghomes.forEach((function(drag){element.removeChild(drag)})),Ddwtos.prototype.shuffleArray(draghomes),draghomes.forEach((function(drag){element.appendChild(drag)}))}));Ddwtos.prototype.initEvents(),Ddwtos.prototype.resizeAllDragsAndDrops(),Ddwtos.prototype.cloneDrags(),Ddwtos.prototype.positionDrags(),!1===questionEnd&&Ddwtos.prototype.initDragAndDrop()},Ddwtos.prototype.shuffleArray=function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)),temp=array[i];array[i]=array[j],array[j]=temp}return array},Ddwtos.prototype.initEvents=function(){addEventListener("timeFinish",Ddwtos.prototype.reply,{once:!0}),!1!==manualMode&&(addEventListener("teacherQuestionEnd_"+jqid,(function(e){!0!==questionEnd&&Ddwtos.prototype.reply(),e.detail.statistics.forEach((function(statistic){(0,_jquery.default)("#statistics .correct").attr("aria-valuenow",statistic.correct).width(statistic.correct+"%").html(statistic.correct+"%"),(0,_jquery.default)("#statistics .failure").attr("aria-valuenow",statistic.failure).width(statistic.failure+"%").html(statistic.failure+"%"),(0,_jquery.default)("#statistics .invalid").attr("aria-valuenow",statistic.invalid).width(statistic.invalid+"%").html(statistic.invalid+"%"),(0,_jquery.default)("#statistics .noresponse").attr("aria-valuenow",statistic.noresponse).width(statistic.noresponse+"%").html(statistic.noresponse+"%"),(0,_jquery.default)("#statistics .partially").attr("aria-valuenow",statistic.partially).width(statistic.partially+"%").html(statistic.partially+"%")}))}),{once:!0}),addEventListener("pauseQuestion_"+jqid,(function(){Ddwtos.prototype.pauseQuestion()}),!1),addEventListener("playQuestion_"+jqid,(function(){Ddwtos.prototype.playQuestion()}),!1),addEventListener("showAnswers_"+jqid,(function(){Ddwtos.prototype.showAnswers()}),!1),addEventListener("hideAnswers_"+jqid,(function(){Ddwtos.prototype.hideAnswers()}),!1),addEventListener("showStatistics_"+jqid,(function(){Ddwtos.prototype.showStatistics()}),!1),addEventListener("hideStatistics_"+jqid,(function(){Ddwtos.prototype.hideStatistics()}),!1),addEventListener("showFeedback_"+jqid,(function(){Ddwtos.prototype.showFeedback()}),!1),addEventListener("hideFeedback_"+jqid,(function(){Ddwtos.prototype.hideFeedback()}),!1),addEventListener("removeEvents",(function(){Ddwtos.prototype.removeEvents()}),{once:!0})),window.onbeforeunload=function(){if((0,_jquery.default)(REGION.SECONDS).length>0&&!1===questionEnd)return Ddwtos.prototype.reply(),"Because the question is overdue and an attempt has been made to reload the page, the question has remained unanswered."}},Ddwtos.prototype.showStatistics=function(){!0===questionEnd&&(0,_jquery.default)("#statistics").css({display:"block","z-index":3})},Ddwtos.prototype.hideStatistics=function(){!0===questionEnd&&(0,_jquery.default)("#statistics").css({display:"none","z-index":0})},Ddwtos.prototype.removeEvents=function(){removeEventListener("timeFinish",Ddwtos.prototype.reply,{once:!0}),!1!==manualMode&&(removeEventListener("teacherQuestionEnd_"+jqid,(function(e){!0!==questionEnd&&Ddwtos.prototype.reply(),e.detail.statistics.forEach((function(statistic){(0,_jquery.default)("#statistics .correct").attr("aria-valuenow",statistic.correct).width(statistic.correct+"%").html(statistic.correct+"%"),(0,_jquery.default)("#statistics .failure").attr("aria-valuenow",statistic.failure).width(statistic.failure+"%").html(statistic.failure+"%"),(0,_jquery.default)("#statistics .invalid").attr("aria-valuenow",statistic.invalid).width(statistic.invalid+"%").html(statistic.invalid+"%"),(0,_jquery.default)("#statistics .noresponse").attr("aria-valuenow",statistic.noresponse).width(statistic.noresponse+"%").html(statistic.noresponse+"%"),(0,_jquery.default)("#statistics .partially").attr("aria-valuenow",statistic.partially).width(statistic.partially+"%").html(statistic.partially+"%")}))}),{once:!0}),removeEventListener("pauseQuestion_"+jqid,(function(){Ddwtos.prototype.pauseQuestion()}),!1),removeEventListener("playQuestion_"+jqid,(function(){Ddwtos.prototype.playQuestion()}),!1),removeEventListener("showAnswers_"+jqid,(function(){Ddwtos.prototype.showAnswers()}),!1),removeEventListener("hideAnswers_"+jqid,(function(){Ddwtos.prototype.hideAnswers()}),!1),removeEventListener("showStatistics_"+jqid,(function(){Ddwtos.prototype.showStatistics()}),!1),removeEventListener("hideStatistics_"+jqid,(function(){Ddwtos.prototype.hideStatistics()}),!1),removeEventListener("showFeedback_"+jqid,(function(){Ddwtos.prototype.showFeedback()}),!1),removeEventListener("hideFeedback_"+jqid,(function(){Ddwtos.prototype.hideFeedback()}),!1),removeEventListener("removeEvents",(function(){Ddwtos.prototype.removeEvents()}),{once:!0}))},Ddwtos.prototype.reply=function(){_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){(0,_jquery.default)(REGION.ROOT).append(html),dispatchEvent(Ddwtos.prototype.endTimer),Ddwtos.prototype.removeEvents();var inputPlaces=document.querySelectorAll(REGION.INPUTPLACE),response={},i=1;inputPlaces.forEach((function(input){response["p"+i]=input.value,i++}));var timeLeft=parseInt((0,_jquery.default)(REGION.SECONDS).text()),request={methodname:SERVICES_REPLY,args:{sessionid:sId,jqshowid:jqshowId,cmid:cmId,questionid:questionid,jqid:jqid,timeleft:timeLeft||0,preview:!1,response:JSON.stringify(response)}};_ajax.default.call([request])[0].done((function(response){!0===response.reply_status?(questionEnd=!0,Ddwtos.prototype.answered(response,!0),dispatchEvent(Ddwtos.prototype.studentQuestionEnd),((0,_jquery.default)(".modal-body").length||!1===manualMode)&&(Ddwtos.prototype.showAnswers(),!0===showQuestionFeedback&&Ddwtos.prototype.showFeedback())):alert("error"),(0,_jquery.default)(REGION.LOADING).remove()})).fail(_notification.default.exception)}))},Ddwtos.prototype.initDragAndDrop=function(){document.querySelectorAll(REGION.DRAGELEMENT).forEach((function(dragElement){dragElement.setAttribute("draggable","false"),(0,_jquery.default)(dragElement).unbind("mousedown touchstart"),(0,_jquery.default)(dragElement).on("mousedown touchstart",Ddwtos.prototype.handleDragStart.bind(this))}))},Ddwtos.prototype.handleDragStart=function(e){var drag=(0,_jquery.default)(e.target).closest(".draghome");if(_dragdrop.default.prepare(e).start&&!drag.hasClass("beingdragged")){drag.addClass("beingdragged");var currentPlace=Ddwtos.prototype.getClassnameNumericSuffix(drag,"inplace");if(null!==currentPlace){Ddwtos.prototype.setInputValue(currentPlace,0),drag.removeClass("inplace"+currentPlace);var hiddenDrop=Ddwtos.prototype.getDrop(drag,currentPlace);hiddenDrop.length&&(hiddenDrop.addClass("active"),drag.offset(hiddenDrop.offset()))}else{var hiddenDrag=Ddwtos.prototype.getDragClone(drag);if(hiddenDrag.length)if(drag.hasClass("infinite")){var noOfDrags=Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(drag));if(Ddwtos.prototype.getInfiniteDragClones(drag,!1).length<noOfDrags){var cloneDrag=drag.clone();cloneDrag.removeClass("beingdragged"),hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag),drag.offset(cloneDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}else hiddenDrag.addClass("active"),drag.offset(hiddenDrag.offset())}_dragdrop.default.start(e,drag,(function(x,y,drag){Ddwtos.prototype.dragMove(x,y,drag)}),(function(x,y,drag){Ddwtos.prototype.dragEnd(x,y,drag)}))}},Ddwtos.prototype.answered=function(response){var fromService=arguments.length>1&&void 0!==arguments[1]&&arguments[1];questionEnd=!0,response.hasfeedbacks&&((0,_jquery.default)(REGION.FEEDBACK).html(response.statment_feedback),(0,_jquery.default)(REGION.FEEDBACKANSWER).html(response.answer_feedback)),(0,_jquery.default)(ACTION.SEND_RESPONSE).addClass("d-none"),(0,_jquery.default)(REGION.FEEDBACKBACGROUND).css("display","block"),(0,_jquery.default)(REGION.STATEMENTTEXT).css({"z-index":3,padding:"15px"}),(0,_jquery.default)(REGION.TIMER).css("z-index",3),!1===manualMode&&(0,_jquery.default)(REGION.NEXT).removeClass("d-none"),!0===fromService&&((0,_jquery.default)(REGION.STATEMENTTEXT_CONTENT).html(decodeURIComponent(escape(atob(response.question_text_feedback)))),Ddwtos.prototype.resizeAllDragsAndDrops(),Ddwtos.prototype.cloneDrags(),Ddwtos.prototype.positionDrags()),document.querySelectorAll(REGION.DRAGHOME).forEach((function(dragElement){dragElement.setAttribute("draggable","false"),(0,_jquery.default)(dragElement).unbind("mousedown touchstart"),(0,_jquery.default)(dragElement).off("mousedown touchstart"),(0,_jquery.default)(dragElement).css({"pointer-events":"none"})})),_event.default.notifyFilterContentUpdated(document.querySelector(REGION.CONTENTFEEDBACKS))},Ddwtos.prototype.pauseQuestion=function(){dispatchEvent(new Event("pauseQuestion")),(0,_jquery.default)(REGION.TIMER).css("z-index",3),(0,_jquery.default)(REGION.FEEDBACKBACGROUND).css("display","block"),(0,_jquery.default)(ACTION.REPLY).css("pointer-events","none")},Ddwtos.prototype.playQuestion=function(){!0!==questionEnd&&(dispatchEvent(new Event("playQuestion")),(0,_jquery.default)(REGION.TIMER).css("z-index",1),(0,_jquery.default)(REGION.FEEDBACKBACGROUND).css("display","none"),(0,_jquery.default)(ACTION.REPLY).css("pointer-events","auto"))},Ddwtos.prototype.showFeedback=function(){!0===questionEnd&&(0,_jquery.default)(REGION.CONTENTFEEDBACKS).css({display:"block","z-index":3})},Ddwtos.prototype.hideFeedback=function(){!0===questionEnd&&(0,_jquery.default)(REGION.CONTENTFEEDBACKS).css({display:"none","z-index":0})},Ddwtos.prototype.showAnswers=function(){!0===questionEnd&&(0,_jquery.default)(REGION.ICONSANSWERS).css({display:"inline-block"})},Ddwtos.prototype.hideAnswers=function(){!0===questionEnd&&(0,_jquery.default)(REGION.ICONSANSWERS).css({display:"none"})},Ddwtos.prototype.resizeAllDragsAndDrops=function(){var thisQ=this;(0,_jquery.default)(REGION.AREA).find(".answercontainer > div").each((function(i,node){thisQ.resizeAllDragsAndDropsInGroup(thisQ.getClassnameNumericSuffix((0,_jquery.default)(node),"draggrouphomes"))}))},Ddwtos.prototype.cloneDrags=function(){(0,_jquery.default)(REGION.AREA).find("span.draghome").each((function(index,draghome){var drag=(0,_jquery.default)(draghome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("draghome choice"+Ddwtos.prototype.getChoice(drag)+" group"+Ddwtos.prototype.getGroup(drag)+" dragplaceholder"),drag.before(placeHolder)}))},Ddwtos.prototype.positionDrags=function(){var root=(0,_jquery.default)(REGION.AREA);root.find("span.draghome").not(".dragplaceholder").each((function(i,dragNode){var drag=(0,_jquery.default)(dragNode),currentPlace=Ddwtos.prototype.getClassnameNumericSuffix(drag,"inplace");drag.addClass("unplaced").removeClass("placed"),drag.removeAttr("tabindex"),null!==currentPlace&&drag.removeClass("inplace"+currentPlace)})),root.find("input.placeinput").each((function(i,inputNode){var input=(0,_jquery.default)(inputNode),choice=input.val(),place=Ddwtos.prototype.getPlace(input),drop=root.find(".drop.place"+place),dropPosition=drop.offset();if(drop.data("prev-top",dropPosition.top).data("prev-left",dropPosition.left),"0"!==choice){var unplacedDrag=Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input),choice),hiddenDrag=Ddwtos.prototype.getDragClone(unplacedDrag);if(hiddenDrag.length)if(unplacedDrag.hasClass("infinite")){var noOfDrags=Ddwtos.prototype.noOfDropsInGroup(Ddwtos.prototype.getGroup(unplacedDrag));if(Ddwtos.prototype.getInfiniteDragClones(unplacedDrag,!1).length<noOfDrags){var cloneDrag=unplacedDrag.clone();hiddenDrag.after(cloneDrag),questionManager.addEventHandlersToDrag(cloneDrag)}else hiddenDrag.addClass("active")}else hiddenDrag.addClass("active");Ddwtos.prototype.sendDragToDrop(Ddwtos.prototype.getUnplacedChoice(Ddwtos.prototype.getGroup(input),choice),drop)}})),Ddwtos.prototype.questionAnswer=Ddwtos.prototype.getQuestionAnsweredValues()},Ddwtos.prototype.handleDragMoved=function(e,drag,target){drag.removeClass("beingdragged"),drag.css("top","").css("left",""),target.after(drag),target.removeClass("active"),void 0!==drag.data("unplaced")&&!0===drag.data("unplaced")&&(drag.removeClass("placed").addClass("unplaced"),drag.removeAttr("tabindex"),drag.removeData("unplaced"),drag.hasClass("infinite")&&Ddwtos.prototype.getInfiniteDragClones(drag,!0).length>1&&Ddwtos.prototype.getInfiniteDragClones(drag,!0).first().remove()),void 0!==drag.data("isfocus")&&!0===drag.data("isfocus")&&(drag.focus(),drag.removeData("isfocus")),void 0!==target.data("isfocus")&&!0===target.data("isfocus")&&target.removeData("isfocus"),Ddwtos.prototype.isQuestionInteracted()&&(Ddwtos.prototype.questionAnswer=Ddwtos.prototype.getQuestionAnsweredValues())},Ddwtos.prototype.isPointInDrop=function(pageX,pageY,drop){var position=drop.offset();return pageX>=position.left&&pageX<position.left+drop.width()&&pageY>=position.top&&pageY<position.top+drop.height()},Ddwtos.prototype.sendDragToDrop=function(drag,drop){var oldDrag=Ddwtos.prototype.getCurrentDragInPlace(Ddwtos.prototype.getPlace(drop));if(0!==oldDrag.length){var currentPlace=Ddwtos.prototype.getClassnameNumericSuffix(oldDrag,"inplace"),hiddenDrop=Ddwtos.prototype.getDrop(oldDrag,currentPlace);hiddenDrop.addClass("active"),oldDrag.addClass("beingdragged"),oldDrag.offset(hiddenDrop.offset()),Ddwtos.prototype.sendDragHome(oldDrag)}if(0===drag.length)Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop),0),drop.data("isfocus")&&drop.focus();else{if(Ddwtos.prototype.getClassnameNumericSuffix(drag,"inplace"))return;Ddwtos.prototype.setInputValue(Ddwtos.prototype.getPlace(drop),Ddwtos.prototype.getChoice(drag)),drag.removeClass("unplaced").addClass("placed inplace"+Ddwtos.prototype.getPlace(drop)),drag.attr("tabindex",0),Ddwtos.prototype.animateTo(drag,drop)}},Ddwtos.prototype.sendDragHome=function(drag){var currentPlace=Ddwtos.prototype.getClassnameNumericSuffix(drag,"inplace");null!==currentPlace&&drag.removeClass("inplace"+currentPlace),drag.data("unplaced",!0),Ddwtos.prototype.animateTo(drag,Ddwtos.prototype.getDragHome(Ddwtos.prototype.getGroup(drag),Ddwtos.prototype.getChoice(drag)))},Ddwtos.prototype.getPlace=function(node){return Ddwtos.prototype.getClassnameNumericSuffix(node,"place")},Ddwtos.prototype.getQuestionAnsweredValues=function(){var result={};return(0,_jquery.default)(REGION.AREA).find("input.placeinput").each((function(i,inputNode){result[inputNode.id]=inputNode.value})),result},Ddwtos.prototype.animateTo=function(drag,target){if(void 0!==target){var currentPos=drag.offset(),targetPos=target.offset(),thisQ=this;void 0!==targetPos&&drag.animate({left:parseInt(drag.css("left"))+targetPos.left-currentPos.left,top:parseInt(drag.css("top"))+targetPos.top-currentPos.top},{duration:"fast",done:function(){(0,_jquery.default)("body").trigger("qtype_ddwtos-dragmoved",[drag,target,thisQ])}})}},Ddwtos.prototype.getDragHome=function(group,choice){return(0,_jquery.default)(REGION.AREA).find(".draghome.dragplaceholder.group"+group+".choice"+choice).is(":visible")?(0,_jquery.default)(REGION.AREA).find(".draghome.dragplaceholder.group"+group+".choice"+choice):(0,_jquery.default)(REGION.AREA).find(".draggrouphomes"+group+" span.draghome.infinite.choice"+choice+".group"+group)},Ddwtos.prototype.getCurrentDragInPlace=function(place){return(0,_jquery.default)(REGION.AREA).find("span.draghome.inplace"+place)},Ddwtos.prototype.resizeAllDragsAndDropsInGroup=function(group){var thisQ=this,dragHomes=(0,_jquery.default)(REGION.AREA).find(".draggrouphomes"+group+" span.draghome"),maxWidth=0,maxHeight=0;dragHomes.each((function(i,drag){maxWidth=Math.max(maxWidth,Math.ceil(drag.offsetWidth)),maxHeight=Math.max(maxHeight,Math.ceil(0+drag.offsetHeight))})),maxWidth+=8,maxHeight+=2,dragHomes.each((function(i,drag){thisQ.setElementSize(drag,maxWidth,maxHeight)})),(0,_jquery.default)(REGION.AREA).find("span.drop.group"+group).each((function(i,drop){thisQ.setElementSize(drop,maxWidth,maxHeight)}))},Ddwtos.prototype.setElementSize=function(element,width,height){(0,_jquery.default)(element).width(width).height(height).css("lineHeight",height+"px")},Ddwtos.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=node.attr("class");if(""!==classes&&void 0!==classes)for(var classesArr=classes.split(" "),index=0;index<classesArr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesArr[index])){var match=new RegExp("([0-9])+$").exec(classesArr[index]);return Number(match[0])}}return null},Ddwtos.prototype.setInputValue=function(place,choice){(0,_jquery.default)(REGION.AREA).find("input.placeinput.place"+place).val(choice)},Ddwtos.prototype.getDrop=function(drag,currentPlace){return(0,_jquery.default)(REGION.AREA).find(".drop.group"+Ddwtos.prototype.getGroup(drag)+".place"+currentPlace)},Ddwtos.prototype.getGroup=function(node){return Ddwtos.prototype.getClassnameNumericSuffix(node,"group")},Ddwtos.prototype.getDragClone=function(drag){return(0,_jquery.default)(REGION.AREA).find(".draggrouphomes"+Ddwtos.prototype.getGroup(drag)+" span.draghome.choice"+Ddwtos.prototype.getChoice(drag)+".group"+Ddwtos.prototype.getGroup(drag)+".dragplaceholder")},Ddwtos.prototype.getChoice=function(drag){return Ddwtos.prototype.getClassnameNumericSuffix(drag,"choice")},Ddwtos.prototype.noOfDropsInGroup=function(group){return(0,_jquery.default)(REGION.AREA).find(".drop.group"+group).length},Ddwtos.prototype.getInfiniteDragClones=function(drag,inHome){return inHome?(0,_jquery.default)(REGION.AREA).find(".draggrouphomes"+Ddwtos.prototype.getGroup(drag)+" span.draghome.choice"+Ddwtos.prototype.getChoice(drag)+".group"+Ddwtos.prototype.getGroup(drag)+".infinite").not(".dragplaceholder"):(0,_jquery.default)(REGION.AREA).find("span.draghome.choice"+Ddwtos.prototype.getChoice(drag)+".group"+Ddwtos.prototype.getGroup(drag)+".infinite").not(".dragplaceholder")},Ddwtos.prototype.dragMove=function(pageX,pageY,drag){(0,_jquery.default)(REGION.AREA).find("span.group"+Ddwtos.prototype.getGroup(drag)).not(".beingdragged").each((function(i,dropNode){var drop=(0,_jquery.default)(dropNode);Ddwtos.prototype.isPointInDrop(pageX,pageY,drop)?drop.addClass("valid-drag-over-drop"):drop.removeClass("valid-drag-over-drop")}))},Ddwtos.prototype.dragEnd=function(pageX,pageY,drag){var root=(0,_jquery.default)(REGION.AREA),placed=!1;root.find("span.group"+Ddwtos.prototype.getGroup(drag)).not(".beingdragged").each((function(i,dropNode){if(placed)return!1;var dropZone=(0,_jquery.default)(dropNode);if(!Ddwtos.prototype.isPointInDrop(pageX,pageY,dropZone))return!0;var drop=null;return dropZone.hasClass("placed")?(dropZone.removeClass("valid-drag-over-drop"),drop=Ddwtos.prototype.getDrop(drag,Ddwtos.prototype.getClassnameNumericSuffix(dropZone,"inplace"))):drop=dropZone,!!drop.hasClass("draghome")||(drop.removeClass("valid-drag-over-drop"),Ddwtos.prototype.sendDragToDrop(drag,drop),placed=!0,!1)})),placed||Ddwtos.prototype.sendDragHome(drag)},Ddwtos.prototype.isQuestionInteracted=function(){var oldAnswer=Ddwtos.prototype.questionAnswer,newAnswer=Ddwtos.prototype.getQuestionAnsweredValues(),isInteracted=!1;return JSON.stringify(newAnswer)!==JSON.stringify(oldAnswer)?isInteracted=!0:(Object.keys(newAnswer).forEach((function(key){newAnswer[key]!==oldAnswer[key]&&(isInteracted=!0)})),isInteracted)},Ddwtos.prototype.getUnplacedChoice=function(group,choice){return(0,_jquery.default)(REGION.AREA).find(".draghome.group"+group+".choice"+choice+".unplaced").slice(0,1)};var questionManager={eventHandlersInitialised:!1,dragEventHandlersInitialised:{},isKeyboardNavigation:!1,questions:{},init:function(containerId){if(questionManager.questions[containerId]=Ddwtos.prototype,questionManager.eventHandlersInitialised||(questionManager.setupEventHandlers(),questionManager.eventHandlersInitialised=!0),!questionManager.dragEventHandlersInitialised.hasOwnProperty(containerId)){questionManager.dragEventHandlersInitialised[containerId]=!0;var questionContainer=document.getElementById(containerId);questionContainer.classList.contains("ddwtos")&&questionContainer.classList.contains("qtype_ddwtos-readonly")}},setupEventHandlers:function(){(0,_jquery.default)("body").on("qtype_ddwtos-dragmoved",Ddwtos.prototype.handleDragMoved.bind(this))},addEventHandlersToDrag:function(element){element.unbind("mousedown touchstart"),element.on("mousedown touchstart",Ddwtos.prototype.handleDragStart)},getQuestionForEvent:function(e){var containerId=(0,_jquery.default)(e.currentTarget).closest(".que.ddwtos").attr("id");return questionManager.questions[containerId]}};_exports.initDdwtos=function(selector,showquestionfeedback,manualmode,jsonresponse){return new Ddwtos(selector,showquestionfeedback,manualmode,jsonresponse)}}));

//# sourceMappingURL=ddwtos.min.js.map