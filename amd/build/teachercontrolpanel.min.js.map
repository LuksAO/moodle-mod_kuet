{"version":3,"file":"teachercontrolpanel.min.js","sources":["../src/teachercontrolpanel.js"],"sourcesContent":["\"use strict\";\n/* eslint-disable no-unused-vars */\n\nimport jQuery from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\n\nlet REGION = {\n    CONTROLPANEL: '[data-region=\"teacher_control_panel\"]', // This root.\n    JUMPTOINPUT: '[data-input=\"jumpto\"]',\n    SWITCHS: '.showhide-action',\n};\n\nlet ACTION = {\n    NEXT: '[data-action=\"next\"]',\n    PAUSE: '[data-action=\"pause\"]',\n    PLAY: '[data-action=\"play\"]',\n    RESEND: '[data-action=\"resend\"]',\n    JUMP: '[data-action=\"jump\"]',\n    FINISHQUESTION: '[data-action=\"finishquestion\"]',\n    SHOWHIDE_RESPONSES: '[data-action=\"showhide_responses\"]',\n    SHOWHIDE_STATISTICS: '[data-action=\"showhide_statistics\"]',\n    SHOWHIDE_FEEDBACK: '[data-action=\"showhide_feedback\"]',\n    IMPROVISE: '[data-action=\"improvise\"]',\n    VOTE: '[data-action=\"vote\"]',\n    ENDSESSION: '[data-action=\"endsession\"]',\n    COLLAPSE: '.teacher-control-panel-collapse',\n};\n\nTeacherControlPanel.prototype.root = null;\nTeacherControlPanel.prototype.jqid = null;\n\n/**\n * @constructor\n * @param {String} region\n * @param {int} jqid\n */\nfunction TeacherControlPanel(region, jqid) {\n    this.root = jQuery(region);\n    this.jqid = jqid;\n    this.initControlPanel();\n    finishquestionEvent = new Event('teacherQuestionEnd_' + this.jqid);\n}\n\nconst nextEvent = new Event('nextQuestion');\nconst pauseEvent = new Event('pauseQuestionSelf');\nconst playEvent = new Event('playQuestionSelf');\nconst resendEvent = new Event('resendSelf');\nconst finishquestionEventSelf = new Event('teacherQuestionEndSelf');\nconst endSession = new Event('endSession');\nconst showAnswers = new Event('showAnswersSelf');\nconst hideAnswers = new Event('hideAnswersSelf');\nconst showStatistics = new Event('showStatisticsSelf');\nconst hideStatistics = new Event('hideStatisticsSelf');\nconst showFeedback = new Event('showFeedbackSelf');\nconst hideFeedback = new Event('hideFeedbackSelf');\nlet finishquestionEvent = null;\nlet questionEnd = false;\n\nTeacherControlPanel.prototype.initControlPanel = function() {\n    this.root.find(ACTION.NEXT).on('click', this.next);\n    this.root.find(ACTION.PAUSE).on('click', this.pause);\n    this.root.find(ACTION.PLAY).on('click', this.play);\n    this.root.find(ACTION.RESEND).on('click', this.resend);\n    this.root.find(ACTION.JUMP).on('click', this.jump);\n    this.root.find(REGION.JUMPTOINPUT).on('keyup', (e) => {\n        if (e.key === 'Enter' || e.keyCode === 13) {\n            TeacherControlPanel.prototype.jump();\n        }\n    });\n    this.root.find(ACTION.FINISHQUESTION).on('click', this.finishquestion);\n    this.root.find(ACTION.ENDSESSION).on('click', this.endsession);\n    this.root.find(ACTION.SHOWHIDE_RESPONSES).on('click', function(e) {\n        if (jQuery(ACTION.SHOWHIDE_RESPONSES).is(':checked')) {\n            TeacherControlPanel.prototype.showAnswers();\n        } else {\n            TeacherControlPanel.prototype.hideAnswers();\n        }\n    });\n    this.root.find(ACTION.SHOWHIDE_STATISTICS).on('click', function() {\n        if (jQuery(ACTION.SHOWHIDE_STATISTICS).is(':checked')) {\n            TeacherControlPanel.prototype.showStatistics();\n        } else {\n            TeacherControlPanel.prototype.hideStatistics();\n        }\n    });\n    this.root.find(ACTION.SHOWHIDE_FEEDBACK).on('click', function() {\n        if (jQuery(ACTION.SHOWHIDE_FEEDBACK).is(':checked')) {\n            TeacherControlPanel.prototype.showFeedback();\n        } else {\n            TeacherControlPanel.prototype.hideFeedback();\n        }\n    });\n    jQuery(ACTION.COLLAPSE).on('click', function() {\n        setTimeout(function() {\n            if (jQuery(ACTION.COLLAPSE + '.collapsed').length !== 0) {\n                jQuery('.content-raceresults').animate({\n                    width: '100%'\n                }, 400).css({\n                    width: '100%'\n                });\n            } else {\n                jQuery('.content-raceresults').animate({\n                    width: jQuery('.question-body').width() - 260 + 'px'\n                }, 400).css({\n                    width: 'calc(100% - 260px)'\n                });\n            }\n        }, 100);\n    });\n};\n\n// TODO prevent default and stop propagations.\n// TODO disable show/hide until the question is finalised.\n\nTeacherControlPanel.prototype.next = function() {\n    dispatchEvent(nextEvent);\n};\n\nTeacherControlPanel.prototype.pause = function() {\n    dispatchEvent(pauseEvent);\n    jQuery(ACTION.PAUSE).addClass('d-none');\n    jQuery(ACTION.PLAY).removeClass('d-none');\n};\n\nTeacherControlPanel.prototype.play = function(e) {\n    dispatchEvent(playEvent);\n    jQuery(ACTION.PAUSE).removeClass('d-none');\n    jQuery(ACTION.PLAY).addClass('d-none');\n};\n\nTeacherControlPanel.prototype.resend = function() {\n    dispatchEvent(resendEvent);\n};\n\nTeacherControlPanel.prototype.jump = function() {\n    let numquestion = jQuery(REGION.JUMPTOINPUT).data('numquestions');\n    let value = jQuery(REGION.JUMPTOINPUT).val();\n    if (value > numquestion || value < 1) {\n        const stringkeys = [\n            {key: 'jump', component: 'mod_jqshow'},\n            {key: 'jumpto_error', component: 'mod_jqshow', param: numquestion},\n            {key: 'confirm', component: 'mod_jqshow'}\n        ];\n        getStrings(stringkeys).then((langStrings) => {\n            return ModalFactory.create({\n                title: langStrings[0],\n                body: langStrings[1],\n                type: ModalFactory.types.CANCEL\n            }).then(modal => {\n                modal.getRoot().on(ModalEvents.hidden, () => {\n                    jQuery(REGION.JUMPTOINPUT).val('');\n                    modal.destroy();\n                });\n                return modal;\n            });\n        }).done(function(modal) {\n            modal.show();\n        }).fail(Notification.exception);\n    } else {\n        let jumpEvent = new CustomEvent('jumpTo', {\n            \"detail\": {\"jumpTo\": value}\n        });\n        dispatchEvent(jumpEvent);\n    }\n};\n\nTeacherControlPanel.prototype.finishquestion = function() {\n    dispatchEvent(finishquestionEventSelf);\n    questionEnd = true;\n    jQuery(REGION.SWITCHS).removeClass('disabled');\n};\n\nTeacherControlPanel.prototype.showAnswers = function() {\n    dispatchEvent(showAnswers);\n};\n\nTeacherControlPanel.prototype.hideAnswers = function() {\n    dispatchEvent(hideAnswers);\n};\n\nTeacherControlPanel.prototype.showStatistics = function() {\n    dispatchEvent(showStatistics);\n};\n\nTeacherControlPanel.prototype.hideStatistics = function() {\n    dispatchEvent(hideStatistics);\n};\n\nTeacherControlPanel.prototype.showFeedback = function() {\n    dispatchEvent(showFeedback);\n};\n\nTeacherControlPanel.prototype.hideFeedback = function() {\n    dispatchEvent(hideFeedback);\n};\n\nTeacherControlPanel.prototype.endsession = function() {\n    dispatchEvent(endSession);\n};\n\nexport const teacherControlPanel = (region, jqid) => {\n    return new TeacherControlPanel(region, jqid);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","Object","defineProperty","_exports","value","teacherControlPanel","_jquery","_notification","_modal_factory","_modal_events","REGION","ACTION","TeacherControlPanel","region","jqid","this","root","jQuery","initControlPanel","Event","prototype","nextEvent","pauseEvent","playEvent","resendEvent","finishquestionEventSelf","endSession","showAnswers","hideAnswers","showStatistics","hideStatistics","showFeedback","hideFeedback","find","on","next","pause","play","resend","jump","e","key","keyCode","finishquestion","endsession","is","setTimeout","length","animate","width","css","dispatchEvent","addClass","removeClass","numquestion","data","val","stringkeys","component","param","getStrings","then","langStrings","ModalFactory","create","title","body","type","types","CANCEL","modal","getRoot","ModalEvents","hidden","destroy","done","show","fail","Notification","exception","jumpEvent","CustomEvent","detail","jumpTo"],"mappings":"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"}