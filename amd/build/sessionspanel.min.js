define("mod_jqshow/sessionspanel",["exports","jquery","core/str","core/ajax","core/modal_factory","core/modal_events","core/templates","core/notification"],(function(_exports,_jquery,_str,_ajax,_modal_factory,_modal_events,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initSessionsPanel=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);var cmId,courseId,ACTION_COPYSESSION='[data-action="copy_session"]',ACTION_DELETESESSION='[data-action="delete_session"]',ACTION_INITSESSION='[data-action="init_session"]',SERVICES_SESSIONSPANEL="mod_jqshow_sessionspanel",SERVICES_COPYSESSION="mod_jqshow_copysession",SERVICES_DELETESESSION="mod_jqshow_deletesession",SERVICES_STARTSESSION="mod_jqshow_startsession",REGION_PANEL='[data-region="sessions-panel"]',TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_PANEL="mod_jqshow/sessions_panel";function SessionsPanel(selector){this.node=(0,_jquery.default)(selector),courseId=this.node.attr("data-courseid"),cmId=this.node.attr("data-cmid"),this.initPanel()}SessionsPanel.prototype.node=null,SessionsPanel.prototype.initPanel=function(){this.node.find(ACTION_COPYSESSION).on("click",this.copySession),this.node.find(ACTION_DELETESESSION).on("click",this.deleteSession),this.node.find(ACTION_INITSESSION).on("click",this.initSession)},SessionsPanel.prototype.copySession=function(e){e.preventDefault(),e.stopPropagation();var sessionId=(0,_jquery.default)(e.currentTarget).attr("data-sessionid");(0,_str.get_strings)([{key:"copysession",component:"mod_jqshow"},{key:"copysession_desc",component:"mod_jqshow"},{key:"confirm",component:"mod_jqshow"},{key:"copysessionerror",component:"mod_jqshow"}]).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2],copysessionerror=langStrings[3];return _modal_factory.default.create({title:title,body:confirmMessage,type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(function(){_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){var identifier=(0,_jquery.default)(REGION_PANEL);identifier.append(html);var request={methodname:SERVICES_COPYSESSION,args:{courseid:courseId,sessionid:sessionId}};_ajax.default.call([request])[0].done((function(copied){if(copied){var requestPanel={methodname:SERVICES_SESSIONSPANEL,args:{cmid:cmId}};_ajax.default.call([requestPanel])[0].done((function(response){_templates.default.render(TEMPLATES_PANEL,response).then((function(html,js){identifier.html(html),_templates.default.runTemplateJS(js)})).fail(_notification.default.exception)})).fail(_notification.default.exception)}else _notification.default.exception({message:copysessionerror})}))}))})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(_notification.default.exception)},SessionsPanel.prototype.deleteSession=function(e){e.preventDefault(),e.stopPropagation();var sessionId=(0,_jquery.default)(e.currentTarget).attr("data-sessionid");(0,_str.get_strings)([{key:"deletesession",component:"mod_jqshow"},{key:"deletesession_desc",component:"mod_jqshow"},{key:"confirm",component:"mod_jqshow"},{key:"deletesessionrror",component:"mod_jqshow"}]).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2],copysessionerror=langStrings[3];return _modal_factory.default.create({title:title,body:confirmMessage,type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(function(){_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){var identifier=(0,_jquery.default)(REGION_PANEL);identifier.append(html);var request={methodname:SERVICES_DELETESESSION,args:{courseid:courseId,sessionid:sessionId}};_ajax.default.call([request])[0].done((function(deleted){if(deleted){var requestPanel={methodname:SERVICES_SESSIONSPANEL,args:{cmid:cmId}};_ajax.default.call([requestPanel])[0].done((function(response){var templatePanel=TEMPLATES_PANEL;_templates.default.render(templatePanel,response).done((function(html,js){identifier.html(html),_templates.default.runTemplateJS(js)}))})).fail(_notification.default.exception)}else _notification.default.exception({message:copysessionerror})}))}))})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(_notification.default.exception)},SessionsPanel.prototype.initSession=function(e){e.preventDefault(),e.stopPropagation();var sessionId=(0,_jquery.default)(e.currentTarget).attr("data-sessionid");(0,_str.get_strings)([{key:"init_session",component:"mod_jqshow"},{key:"init_session_desc",component:"mod_jqshow"},{key:"confirm",component:"mod_jqshow"}]).then((function(langStrings){var title=langStrings[0],confirmMessage=langStrings[1],buttonText=langStrings[2];return _modal_factory.default.create({title:title,body:confirmMessage,type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(function(){var request={methodname:SERVICES_STARTSESSION,args:{cmid:cmId,sessionid:sessionId}};_ajax.default.call([request])[0].done((function(response){!0===response.started&&window.location.replace(M.cfg.wwwroot+"/mod/jqshow/session.php?cmid="+cmId+"&sid="+sessionId)})).fail(_notification.default.exception)})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(_notification.default.exception)};_exports.initSessionsPanel=function(selector){return new SessionsPanel(selector)}}));

//# sourceMappingURL=sessionspanel.min.js.map