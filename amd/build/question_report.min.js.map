{"version":3,"file":"question_report.min.js","sources":["../src/question_report.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos.\n\n/**\n *\n * @module    mod_jqshow/question_report\n * @copyright  2023 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n/* eslint-disable no-unused-vars */\n\nimport jQuery from 'jquery';\nimport Templates from 'core/templates';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport ModalJqshow from 'mod_jqshow/modal';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {get_string as getString} from 'core/str';\n\nlet REGION = {\n    ROOT: '[data-region=\"question-report\"]', // This root.\n    LOADING: '[data-region=\"overlay-icon-container\"]',\n};\n\nlet ACTION = {\n    QUESTIONPREVIEW: '[data-action=\"question-preview\"]',\n    SEEANSWER: '[data-action=\"seeanswer\"]',\n};\n\nlet SERVICES = {\n    GETQUESTION: 'mod_jqshow_getquestion',\n    USERQUESTIONRESPONSE: 'mod_jqshow_getuserquestionresponse'\n};\n\nlet TEMPLATES = {\n    LOADING: 'core/overlay_loading',\n    QUESTION: 'mod_jqshow/questions/encasement'\n};\n\nQuestionReport.prototype.root = null;\n\n/**\n * @constructor\n * @param {String} region\n */\nfunction QuestionReport(region) {\n    this.root = jQuery(region);\n    this.root.find(ACTION.QUESTIONPREVIEW).on('click', this.questionPreview);\n    this.root.find(ACTION.SEEANSWER).on('click', this.seeAnswer);\n}\n\nQuestionReport.prototype.questionPreview = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GETQUESTION,\n            args: {\n                cmid: cmId,\n                sid: sessionId,\n                jqid: questionnId\n            }\n        };\n        Ajax.call([request])[0].done(function(question) {\n            Templates.render(TEMPLATES.QUESTION, question).then(function(html, js) {\n                getString('preview', 'mod_jqshow').done((title) => {\n                    ModalFactory.create({\n                        classes: 'modal_jqshow',\n                        body: html,\n                        title: title,\n                        footer: '',\n                        type: ModalJqshow.TYPE\n                    }).then(modal => {\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n                        jQuery(REGION.LOADING).remove();\n                        modal.show();\n                        Templates.runTemplateJS(js);\n                    }).fail(Notification.exception);\n                }).fail(Notification.exception);\n            });\n        });\n    });\n};\n\nQuestionReport.prototype.seeAnswer = function(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    let userId = jQuery(e.currentTarget).attr('data-userid');\n    let sessionId = jQuery(e.currentTarget).attr('data-sessionid');\n    let questionnId = jQuery(e.currentTarget).attr('data-questionnid');\n    let cmId = jQuery(e.currentTarget).attr('data-cmid');\n    Templates.render(TEMPLATES.LOADING, {visible: true}).done(function(html) {\n        let identifier = jQuery(REGION.ROOT);\n        identifier.append(html);\n        let request = {\n            methodname: SERVICES.GETQUESTION,\n            args: {\n                cmid: cmId,\n                sid: sessionId,\n                jqid: questionnId\n            }\n        };\n        Ajax.call([request])[0].done(function(question) {\n            let requestAnswer = {\n                methodname: SERVICES.USERQUESTIONRESPONSE,\n                args: {\n                    jqid: question.jqid,\n                    cmid: cmId,\n                    sid: sessionId,\n                    uid: userId,\n                    preview: true\n                }\n            };\n            Ajax.call([requestAnswer])[0].done(function(answer) {\n                const questionData = {\n                    ...question,\n                    ...answer\n                };\n                getString('viewquestion_user', 'mod_jqshow').done((title) => {\n                    Templates.render(TEMPLATES.QUESTION, questionData).then(function(html, js) {\n                        ModalFactory.create({\n                            classes: 'modal_jqshow',\n                            body: html,\n                            title: title,\n                            footer: '',\n                            type: ModalJqshow.TYPE\n                        }).then(modal => {\n                            modal.getRoot().on(ModalEvents.hidden, function() {\n                                modal.destroy();\n                            });\n                            jQuery(REGION.LOADING).remove();\n                            modal.show();\n                            Templates.runTemplateJS(js);\n                        }).fail(Notification.exception);\n                    }).fail(Notification.exception);\n                }).fail(Notification.exception);\n            });\n        });\n    });\n};\n\nexport const questionReport = (region) => {\n    return new QuestionReport(region);\n};\n"],"names":["_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","arg","input","hint","prim","toPrimitive","undefined","res","call","TypeError","String","Number","_toPrimitive","_toPropertyKey","configurable","writable","_exports","questionReport","_jquery","_templates","_modal_factory","_modal_events","_modal","_ajax","_notification","REGION","ACTION","SERVICES","TEMPLATES","QuestionReport","region","this","root","jQuery","find","on","questionPreview","seeAnswer","e","preventDefault","stopPropagation","sessionId","currentTarget","attr","questionnId","cmId","Templates","render","visible","done","html","append","request","methodname","args","cmid","sid","jqid","Ajax","question","then","js","getString","title","ModalFactory","create","classes","body","footer","type","ModalJqshow","TYPE","modal","getRoot","ModalEvents","hidden","destroy","remove","show","runTemplateJS","fail","Notification","exception","userId","requestAnswer","uid","preview","answer","questionData"],"mappings":"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"}