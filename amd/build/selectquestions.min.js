define("mod_jqshow/selectquestions",["exports","jquery","core/str","core/ajax","core/modal_factory","core/modal_events","core/notification","core/templates"],(function(_exports,_jquery,_str,_ajax,_modal_factory,_modal_events,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initSelectQuestions=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);var cmId,sId,jqshowId,ACTION_ADDQUESTIONS='[data-action="add_questions"]',ACTION_ADDQUESTION='[data-action="add_question"]',ACTION_SELECTALL="#selectall",ACTION_SELECTVISIBLES="#selectvisibles",REGION_PANEL='[data-region="questions-panel"]',REGION_NUMBERSELECT="#number_select",REGION_SELECTQUESTION=".select_question",REGION_CONTENTQUESTIONS="#content_questions",REGION_PAGENAVIGATION="#page_navigation",REGION_CURRENTPAGE="#current_page",REGION_SESSIONQUESTIONS='[data-region="session-questions"]',REGION_LOADING='[data-region="overlay-icon-container"]',SERVICES_ADDQUESTIONS="mod_jqshow_addquestions",SERVICES_SESSIONQUESTIONS="mod_jqshow_sessionquestions",TEMPLATES_LOADING="core/overlay_loading",TEMPLATES_QUESTIONSSELECTED="mod_jqshow/createsession/sessionquestions";function SelectQuestions(selector){this.node=(0,_jquery.default)(selector),sId=this.node.attr("data-sid"),cmId=this.node.attr("data-cmid"),jqshowId=this.node.attr("data-jqshowid"),this.initPanel()}SelectQuestions.prototype.node=null,SelectQuestions.prototype.initPanel=function(){this.node.find(ACTION_SELECTALL).on("change",this.selectAll.bind(this)),this.node.find(ACTION_SELECTVISIBLES).on("change",this.selectVisibles.bind(this)),this.node.find(ACTION_ADDQUESTIONS).on("click",this.addQuestions.bind(this)),this.node.find(ACTION_ADDQUESTION).on("click",this.addQuestion.bind(this)),this.node.find(REGION_SELECTQUESTION).on("change",this.selectQuestion.bind(this)),this.countChecks(),this.pagination()},SelectQuestions.prototype.countChecks=function(){var checksNumber=(0,_jquery.default)(REGION_SELECTQUESTION).length,checkedsNumber=(0,_jquery.default)(REGION_SELECTQUESTION+":checked").length;(0,_jquery.default)(REGION_NUMBERSELECT).html(checkedsNumber),checkedsNumber<checksNumber&&(0,_jquery.default)(ACTION_SELECTALL).prop("checked",!1);var checksNumberVisibles=(0,_jquery.default)('[style="display: flex;"] '+REGION_SELECTQUESTION).length;(0,_jquery.default)('[style="display: flex;"] '+REGION_SELECTQUESTION+":checked").length<checksNumberVisibles&&(0,_jquery.default)(ACTION_SELECTVISIBLES).prop("checked",!1)},SelectQuestions.prototype.selectAll=function(e){e.preventDefault(),e.stopPropagation(),this.node.find(REGION_SELECTQUESTION).prop("checked",(0,_jquery.default)(e.currentTarget).is(":checked")),this.countChecks()},SelectQuestions.prototype.selectVisibles=function(e){e.preventDefault(),e.stopPropagation(),this.node.find('[style="display: flex;"] '+REGION_SELECTQUESTION).prop("checked",(0,_jquery.default)(e.currentTarget).is(":checked")),this.countChecks()},SelectQuestions.prototype.addQuestions=function(e){e.preventDefault(),e.stopPropagation();var that=this,questionschekced=(0,_jquery.default)(REGION_SELECTQUESTION+":checked");if(questionschekced.length<1){(0,_str.get_strings)([{key:"selectone",component:"mod_jqshow"},{key:"selectone_desc",component:"mod_jqshow"}]).then((function(langStrings){var title=langStrings[0],message=langStrings[1];return _modal_factory.default.create({title:title,body:message,type:_modal_factory.default.types.CANCEL}).then((function(modal){return modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(_notification.default.exception)}else{var questions=[];questionschekced.each((function(index,question){var questiondata={questionid:(0,_jquery.default)(question).attr("data-questionnid"),sessionid:sId,jqshowid:jqshowId,qtype:(0,_jquery.default)(question).attr("data-type")};questions.push(questiondata)}));var _stringkeys=[{key:"addquestions",component:"mod_jqshow"},{key:"addquestions_desc",component:"mod_jqshow",param:questionschekced.length},{key:"confirm",component:"mod_jqshow"}];(0,_str.get_strings)(_stringkeys).then((function(langStrings){var title=langStrings[0],message=langStrings[1],buttonText=langStrings[2];return _modal_factory.default.create({title:title,body:message,type:_modal_factory.default.types.SAVE_CANCEL}).then((function(modal){return modal.setSaveButtonText(buttonText),modal.getRoot().on(_modal_events.default.save,(function(){_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){(0,_jquery.default)(REGION_PANEL).append(html)}));var request={methodname:SERVICES_ADDQUESTIONS,args:{questions:questions}};_ajax.default.call([request])[0].done((function(response){if(response){(0,_jquery.default)(REGION_CONTENTQUESTIONS).find(REGION_SELECTQUESTION).prop("checked",!1),(0,_jquery.default)(ACTION_SELECTALL).prop("checked",!1),(0,_jquery.default)(ACTION_SELECTVISIBLES).prop("checked",!1);var _request={methodname:SERVICES_SESSIONQUESTIONS,args:{jqshowid:jqshowId,cmid:cmId,sid:sId}};_ajax.default.call([_request])[0].done((function(response){_templates.default.render(TEMPLATES_QUESTIONSSELECTED,response).then((function(html,js){(0,_jquery.default)(REGION_SESSIONQUESTIONS).html(html),_templates.default.runTemplateJS(js),that.countChecks(),(0,_jquery.default)(REGION_LOADING).remove()})).fail(_notification.default.exception)}))}else alert("error"),(0,_jquery.default)(REGION_LOADING).remove()}))})),modal.getRoot().on(_modal_events.default.hidden,(function(){modal.destroy()})),modal}))})).done((function(modal){modal.show()})).fail(_notification.default.exception)}},SelectQuestions.prototype.addQuestion=function(e){e.preventDefault(),e.stopPropagation();var that=this,questions=[],questiondata={questionid:(0,_jquery.default)(e.currentTarget).attr("data-questionnid"),sessionid:sId,jqshowid:jqshowId,qtype:(0,_jquery.default)(e.currentTarget).attr("data-type")};questions.push(questiondata),_templates.default.render(TEMPLATES_LOADING,{visible:!0}).done((function(html){(0,_jquery.default)(REGION_PANEL).append(html)}));var request={methodname:SERVICES_ADDQUESTIONS,args:{questions:questions}};_ajax.default.call([request])[0].done((function(response){if(response){(0,_jquery.default)(REGION_CONTENTQUESTIONS).find(REGION_SELECTQUESTION).prop("checked",!1),(0,_jquery.default)(ACTION_SELECTALL).prop("checked",!1),(0,_jquery.default)(ACTION_SELECTVISIBLES).prop("checked",!1);var _request2={methodname:SERVICES_SESSIONQUESTIONS,args:{jqshowid:jqshowId,cmid:cmId,sid:sId}};_ajax.default.call([_request2])[0].done((function(response){_templates.default.render(TEMPLATES_QUESTIONSSELECTED,response).then((function(html,js){(0,_jquery.default)(REGION_SESSIONQUESTIONS).html(html),_templates.default.runTemplateJS(js),that.countChecks(),(0,_jquery.default)(REGION_LOADING).remove()})).fail(_notification.default.exception)}))}else alert("error"),(0,_jquery.default)(REGION_LOADING).remove()}))},SelectQuestions.prototype.selectQuestion=function(e){e.preventDefault(),e.stopPropagation(),this.countChecks()},SelectQuestions.prototype.pagination=function(){var numberOfItems=(0,_jquery.default)(REGION_CONTENTQUESTIONS).children().length,numberOfPages=Math.ceil(numberOfItems/20);(0,_jquery.default)(REGION_CURRENTPAGE).val(0);var navigationHtml="",currentLink=0;if(0===numberOfItems&&((0,_jquery.default)(ACTION_SELECTALL).remove(),(0,_jquery.default)('label[for="selectall"]').remove()),numberOfPages>1)for(;numberOfPages>currentLink;)navigationHtml+='<div class="page-item" data-goto="'+currentLink+'"><span class="page-link">'+(currentLink+1)+"</span></div>",currentLink++;else(0,_jquery.default)(ACTION_SELECTVISIBLES).remove(),(0,_jquery.default)('label[for="selectvisibles"]').remove();(0,_jquery.default)(REGION_PAGENAVIGATION).html(navigationHtml),this.node.find(".page-item").on("click",this.goToPage),(0,_jquery.default)(REGION_PAGENAVIGATION+" .page-item:first").addClass("active"),(0,_jquery.default)(REGION_CONTENTQUESTIONS).children().css("display","none"),(0,_jquery.default)(REGION_CONTENTQUESTIONS).children().slice(0,20).css("display","flex")},SelectQuestions.prototype.goToPage=function(e){e.preventDefault(),e.stopPropagation();var gotTo=(0,_jquery.default)(e.currentTarget).attr("data-goto"),startFrom=20*gotTo,endOn=startFrom+20;(0,_jquery.default)(REGION_CONTENTQUESTIONS).children().css("display","none").slice(startFrom,endOn).css("display","flex"),(0,_jquery.default)(".page-item[data-goto="+gotTo+"]").addClass("active").siblings(".active").removeClass("active"),(0,_jquery.default)(ACTION_SELECTVISIBLES).prop("checked",!1),(0,_jquery.default)(REGION_CURRENTPAGE).val(gotTo)};_exports.initSelectQuestions=function(selector){return new SelectQuestions(selector)}}));

//# sourceMappingURL=selectquestions.min.js.map