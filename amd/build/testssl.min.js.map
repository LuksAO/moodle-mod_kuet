{"version":3,"file":"testssl.min.js","sources":["../src/testssl.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// Project implemented by the \"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos.\n\n/**\n *\n * @module    mod_kuet/testssl\n * @copyright  2023 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     3IPUNT <contacte@tresipunt.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/str', 'core/notification'], function($, str, notification) {\n    \"use strict\";\n\n    let socketUrl = '';\n    let portUrl = '8080';\n\n    /**\n     * @constructor\n     * @param {String} region\n     * @param {String} socketurl\n     * @param {String} port\n     */\n    function TestSockets(region, socketurl, port) {\n        this.root = $(region);\n        socketUrl = socketurl;\n        portUrl = port;\n        this.initTestSockets();\n    }\n\n    TestSockets.prototype.normalizeSocketUrl = function(socketUrl, port) {\n        let jsUrl = new URL(socketUrl);\n        if (jsUrl.protocol === 'https:') {\n            jsUrl.port = port;\n            jsUrl.protocol = 'wss:';\n            if (jsUrl.pathname === '/') {\n                jsUrl.pathname = jsUrl.pathname + 'testkuet';\n            } else {\n                jsUrl.pathname = jsUrl.pathname + '/testkuet';\n            }\n            return jsUrl.toString();\n        }\n\n        str.get_strings([\n            {key: 'httpsrequired', component: 'mod_kuet'}\n        ]).done(function(strings) {\n            messageBox = this.root.find('#testresult');\n            messageBox.append('<div class=\"alert alert-danger\" role=\"alert\">' + strings[0] + '</div>');\n        }).fail(notification.exception);\n        return '';\n    };\n\n    /** @type {jQuery} The jQuery node for the page region. */\n    TestSockets.prototype.root = null;\n\n    let messageBox = null;\n\n    TestSockets.prototype.initTestSockets = function() {\n        messageBox = this.root.find('#testresult');\n        let normalizeSocketUrl = TestSockets.prototype.normalizeSocketUrl(socketUrl, portUrl);\n        TestSockets.prototype.webSocket = new WebSocket(normalizeSocketUrl);\n\n        TestSockets.prototype.webSocket.onopen = function() {\n            str.get_strings([\n                {key: 'validcertificates', component: 'mod_kuet'}\n            ]).done(function(strings) {\n                messageBox.append('<div class=\"alert alert-success\" role=\"alert\">' + strings[0] + '</div>');\n            }).fail(notification.exception);\n        };\n\n        TestSockets.prototype.webSocket.onerror = function(event) {\n            // eslint-disable-next-line no-console\n            console.error(event);\n            str.get_strings([\n                {key: 'invalidcertificates', component: 'mod_kuet'}\n            ]).done(function(strings) {\n                messageBox.append('<div class=\"alert alert-danger\" role=\"alert\">' + strings[0] + '</div>');\n            }).fail(notification.exception);\n        };\n\n        TestSockets.prototype.webSocket.onclose = function() {\n            str.get_strings([\n                {key: 'connectionclosed', component: 'mod_kuet'}\n            ]).done(function(strings) {\n                messageBox.append('<div class=\"alert alert-warning\" role=\"alert\">' + strings[0] + '</div>');\n            }).fail(notification.exception);\n        };\n    };\n\n    TestSockets.prototype.sendMessageSocket = function(msg) {\n        this.webSocket.send(msg);\n    };\n\n    return {\n        /**\n         * @param {String} region\n         * @param {String} socketurl\n         * @param {String} port\n         * @return {TestSockets}\n         */\n        initTestSockets: function(region, socketurl, port) {\n            return new TestSockets(region, socketurl, port);\n        },\n    };\n});\n"],"names":["define","$","str","notification","socketUrl","portUrl","TestSockets","region","socketurl","port","this","root","initTestSockets","prototype","normalizeSocketUrl","jsUrl","URL","protocol","pathname","toString","get_strings","key","component","done","strings","messageBox","find","append","fail","exception","webSocket","WebSocket","onopen","onerror","event","console","error","onclose","sendMessageSocket","msg","send"],"mappings":";;;;;;;;AAgCAA,OAAO,mBAAA,CAAC,SAAU,WAAY,sBAAsB,SAASC,EAAGC,IAAKC,cAGjE,IAAIC,UAAY,GACZC,QAAU,OAQd,SAASC,YAAYC,OAAQC,UAAWC,MACpCC,KAAKC,KAAOV,EAAEM,QACdH,UAAYI,UACZH,QAAUI,KACVC,KAAKE,iBACT,CAEAN,YAAYO,UAAUC,mBAAqB,SAASV,UAAWK,MAC3D,IAAIM,MAAQ,IAAIC,IAAIZ,WACpB,MAAuB,WAAnBW,MAAME,UACNF,MAAMN,KAAOA,KACbM,MAAME,SAAW,OACM,MAAnBF,MAAMG,SACNH,MAAMG,SAAWH,MAAMG,SAAW,WAElCH,MAAMG,SAAWH,MAAMG,SAAW,YAE/BH,MAAMI,aAGjBjB,IAAIkB,YAAY,CACZ,CAACC,IAAK,gBAAiBC,UAAW,cACnCC,MAAK,SAASC,UACbC,WAAaf,KAAKC,KAAKe,KAAK,gBACjBC,OAAO,gDAAkDH,QAAQ,GAAK,SACpF,IAAEI,KAAKzB,aAAa0B,WACd,KAIXvB,YAAYO,UAAUF,KAAO,KAE7B,IAAIc,WAAa,KAsCjB,OApCAnB,YAAYO,UAAUD,gBAAkB,WACpCa,WAAaf,KAAKC,KAAKe,KAAK,eAC5B,IAAIZ,mBAAqBR,YAAYO,UAAUC,mBAAmBV,UAAWC,SAC7EC,YAAYO,UAAUiB,UAAY,IAAIC,UAAUjB,oBAEhDR,YAAYO,UAAUiB,UAAUE,OAAS,WACrC9B,IAAIkB,YAAY,CACZ,CAACC,IAAK,oBAAqBC,UAAW,cACvCC,MAAK,SAASC,SACbC,WAAWE,OAAO,iDAAmDH,QAAQ,GAAK,SACrF,IAAEI,KAAKzB,aAAa0B,YAGzBvB,YAAYO,UAAUiB,UAAUG,QAAU,SAASC,OAE/CC,QAAQC,MAAMF,OACdhC,IAAIkB,YAAY,CACZ,CAACC,IAAK,sBAAuBC,UAAW,cACzCC,MAAK,SAASC,SACbC,WAAWE,OAAO,gDAAkDH,QAAQ,GAAK,SACpF,IAAEI,KAAKzB,aAAa0B,YAGzBvB,YAAYO,UAAUiB,UAAUO,QAAU,WACtCnC,IAAIkB,YAAY,CACZ,CAACC,IAAK,mBAAoBC,UAAW,cACtCC,MAAK,SAASC,SACbC,WAAWE,OAAO,iDAAmDH,QAAQ,GAAK,SACrF,IAAEI,KAAKzB,aAAa0B,aAI7BvB,YAAYO,UAAUyB,kBAAoB,SAASC,KAC/C7B,KAAKoB,UAAUU,KAAKD,MAGjB,CAOH3B,gBAAiB,SAASL,OAAQC,UAAWC,MACzC,OAAO,IAAIH,YAAYC,OAAQC,UAAWC,KAC9C,EAER"}